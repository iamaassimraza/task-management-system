/**
 * CropprCore
 * Here lies the main logic.
 */
import Handle from './handle';
import Box from './box';
import enableTouch from './touch';
/**
 * Define a list of handles to create.
 *
 * @property {Array} position - The x and y ratio position of the handle within
 *      the crop region. Accepts a value between 0 to 1 in the order of [X, Y].
 * @property {Array} constraints - Define the side of the crop region that is to
 *      be affected by this handle. Accepts a value of 0 or 1 in the order of
 *      [TOP, RIGHT, BOTTOM, LEFT].
 * @property {String} cursor - The CSS cursor of this handle.
 */
const HANDLES = [
    { position: [0.0, 0.0], constraints: [1, 0, 0, 1], cursor: 'nw-resize' },
    { position: [0.5, 0.0], constraints: [1, 0, 0, 0], cursor: 'n-resize' },
    { position: [1.0, 0.0], constraints: [1, 1, 0, 0], cursor: 'ne-resize' },
    { position: [1.0, 0.5], constraints: [0, 1, 0, 0], cursor: 'e-resize' },
    { position: [1.0, 1.0], constraints: [0, 1, 1, 0], cursor: 'se-resize' },
    { position: [0.5, 1.0], constraints: [0, 0, 1, 0], cursor: 's-resize' },
    { position: [0.0, 1.0], constraints: [0, 0, 1, 1], cursor: 'sw-resize' },
    { position: [0.0, 0.5], constraints: [0, 0, 0, 1], cursor: 'w-resize' },
];
/**
 * Core class for Croppr containing most of its functional logic.
 */
export default class CropprCore {
    constructor(element, options, deferred = false) {
        this.regionEl = null;
        // console.log("ðŸš€ ~ file: core.ts ~ line 51 ~ CropprCore ~ constructor ~ element", element)
        // Parse options
        this.options = CropprCore.parseOptions(options || {});
        // Get target img element
        if (!element.nodeName) {
            element = document.querySelector(element);
            // console.log("ðŸš€ ~ file: core.ts ~ line 58 ~ CropprCore ~ constructor ~ element", element)
            if (element == null) {
                throw 'Unable to find element.';
            }
        }
        if (!element.getAttribute('src')) {
            throw 'Image src not provided.';
        }
        // Define internal props
        this._initialized = false;
        this._restore = {
            parent: element.parentNode,
            element: element,
        };
        // Wait until image is loaded before proceeding
        if (!deferred) {
            if (element.width === 0 || element.height === 0) {
                element.onload = () => {
                    this.initialize(element);
                };
            }
            else {
                this.initialize(element);
            }
        }
    }
    /**
     * Initialize the Croppr instance
     */
    initialize(element) {
        // Create DOM elements
        this.createDOM(element);
        // Process option values
        this.options.convertToPixels(this.cropperEl);
        // Listen for events from children
        this.attachHandlerEvents();
        this.attachRegionEvents();
        this.attachOverlayEvents();
        // Bootstrap this cropper instance
        this.box = this.initializeBox(this.options);
        this.redraw();
        // Set the initalized flag to true and call the callback
        this._initialized = true;
        if (this.options.onInitialize !== null) {
            this.options.onInitialize(this);
        }
    }
    /**
     * Create Croppr's DOM elements
     */
    createDOM(targetEl) {
        // Create main container and use it as the main event listeners
        this.containerEl = document.createElement('div');
        this.containerEl.className = 'croppr-container';
        this.eventBus = this.containerEl;
        enableTouch(this.containerEl);
        // Create cropper element
        this.cropperEl = document.createElement('div');
        this.cropperEl.className = 'croppr';
        // Create image element
        this.imageEl = document.createElement('img');
        this.imageEl.setAttribute('src', targetEl.getAttribute('src'));
        this.imageEl.setAttribute('alt', targetEl.getAttribute('alt'));
        this.imageEl.className = 'croppr-image';
        // Create clipped image element
        this.imageClippedEl = this.imageEl.cloneNode();
        this.imageClippedEl.className = 'croppr-imageClipped';
        // Create region box element
        this.regionEl = document.createElement('div');
        this.regionEl.innerHTML = new Array(9)
            .fill(1)
            .map(() => `<div style="border: 1px dashed #fafafa"></div>`)
            .join('');
        this.regionEl.className = 'croppr-region';
        // Create overlay element
        this.overlayEl = document.createElement('div');
        this.overlayEl.className = 'croppr-overlay';
        // Create handles element
        let handleContainerEl = document.createElement('div');
        handleContainerEl.className = 'croppr-handleContainer';
        this.handles = [];
        for (let i = 0; i < HANDLES.length; i++) {
            const handle = new Handle(HANDLES[i].position, HANDLES[i].constraints, HANDLES[i].cursor, this.eventBus);
            this.handles.push(handle);
            handleContainerEl.appendChild(handle.el);
        }
        // And then we piece it all together!
        this.cropperEl.appendChild(this.imageEl);
        this.cropperEl.appendChild(this.imageClippedEl);
        this.cropperEl.appendChild(this.regionEl);
        this.cropperEl.appendChild(this.overlayEl);
        this.cropperEl.appendChild(handleContainerEl);
        this.containerEl.appendChild(this.cropperEl);
        // And then finally insert it into the document
        targetEl.parentElement.replaceChild(this.containerEl, targetEl);
    }
    /**
     * Changes the image src.
     * @param {String} src
     */
    setImage(src) {
        // Add onload listener to reinitialize box
        this.imageEl.onload = () => {
            this.box = this.initializeBox(this.options);
            this.redraw();
        };
        // Change image source
        this.imageEl.src = src;
        this.imageClippedEl.src = src;
        return this;
    }
    /**
     * Destroy the Croppr instance and replace with the original element.
     */
    destroy() {
        this._restore.parent.replaceChild(this._restore.element, this.containerEl);
    }
    /**
     * Create a new box region with a set of options.
     * @param {Object} opts The options.
     * @returns {Box}
     */
    initializeBox(opts) {
        // Create initial box
        const width = opts.startSize.width;
        const height = opts.startSize.height;
        let box = new Box(0, 0, width, height);
        // console.log("ðŸš€ ~ file: core.ts ~ line 202 ~ CropprCore ~ initializeBox ~ box", box)
        // Maintain ratio
        box.constrainToRatio(opts.aspectRatio, [0.5, 0.5]);
        // Maintain minimum/maximum size
        const min = opts.minSize;
        const max = opts.maxSize;
        box.constrainToSize(max.width, max.height, min.width, min.height, [0.5, 0.5], opts.aspectRatio);
        // Constrain to boundary
        const parentWidth = this.cropperEl.offsetWidth;
        const parentHeight = this.cropperEl.offsetHeight;
        box.constrainToBoundary(parentWidth, parentHeight, [0.5, 0.5]);
        // // Move to center
        const x = this.cropperEl.offsetWidth / 2 - box.width() / 2;
        const y = this.cropperEl.offsetHeight / 2 - box.height() / 2;
        // console.log("ðŸš€ ~ file: core.ts ~ line 219 ~ CropprCore ~ initializeBox ~ this.cropperEl", this.cropperEl.offsetWidth)
        // console.log("ðŸš€ ~ file: core.ts ~ line 223 ~ CropprCore ~ initializeBox ~ x, y", x, y)
        box.move(x, y);
        return box;
    }
    /**
     * Draw visuals (border, handles, etc) for the current box.
     */
    redraw() {
        // Round positional values to prevent subpixel coordinates, which can
        // result in element that is rendered blurly
        const width = Math.round(this.box.width()), height = Math.round(this.box.height()), x1 = Math.round(this.box.x1), y1 = Math.round(this.box.y1), x2 = Math.round(this.box.x2), y2 = Math.round(this.box.y2);
        window.requestAnimationFrame(() => {
            // Update region element
            if (!this.regionEl)
                return;
            this.regionEl.style.transform = `translate(${x1}px, ${y1}px)`;
            this.regionEl.style.width = width + 'px';
            this.regionEl.style.height = height + 'px';
            // Update clipped image element
            this.imageClippedEl.style.clip = `rect(${y1}px, ${x2}px, ${y2}px, ${x1}px)`;
            // Determine which handle to bring forward. The following code
            // calculates the quadrant the box is in using bitwise operators.
            // Reference: https://stackoverflow.com/questions/9718059
            const center = this.box.getAbsolutePoint([0.5, 0.5]);
            const xSign = (center[0] - this.cropperEl.offsetWidth / 2) >> 31;
            const ySign = (center[1] - this.cropperEl.offsetHeight / 2) >> 31;
            const quadrant = (xSign ^ ySign) + ySign + ySign + 4;
            // The following equation calculates which handle index to bring
            // forward. The equation is derived using algebra (if youre curious)
            const foregroundHandleIndex = -2 * quadrant + 8;
            // Update handle positions
            for (let i = 0; i < this.handles.length; i++) {
                let handle = this.handles[i];
                // Calculate handle position
                const handleWidth = handle.el.offsetWidth;
                const handleHeight = handle.el.offsetHeight;
                const left = x1 + width * handle.position[0] - handleWidth / 2;
                const top = y1 + height * handle.position[1] - handleHeight / 2;
                // Apply new position. The positional values are rounded to
                // prevent subpixel positions which can result in a blurry element
                handle.el.style.transform = `translate(${Math.round(left)}px, ${Math.round(top)}px)`;
                handle.el.style.zIndex = foregroundHandleIndex == i ? 5 : 4;
            }
        });
    }
    /**
     * Attach listeners for events emitted by the handles.
     * Enables resizing of the region element.
     */
    attachHandlerEvents() {
        const eventBus = this.eventBus;
        eventBus.addEventListener('handlestart', this.onHandleMoveStart.bind(this));
        eventBus.addEventListener('handlemove', this.onHandleMoveMoving.bind(this));
        eventBus.addEventListener('handleend', this.onHandleMoveEnd.bind(this));
    }
    /**
     * Attach event listeners for the crop region element.
     * Enables dragging/moving of the region element.
     */
    attachRegionEvents() {
        const eventBus = this.eventBus;
        const self = this;
        if (!this.regionEl)
            return;
        this.regionEl.addEventListener('mousedown', onMouseDown);
        eventBus.addEventListener('regionstart', this.onRegionMoveStart.bind(this));
        eventBus.addEventListener('regionmove', this.onRegionMoveMoving.bind(this));
        eventBus.addEventListener('regionend', this.onRegionMoveEnd.bind(this));
        function onMouseDown(e) {
            e.stopPropagation();
            document.addEventListener('mouseup', onMouseUp);
            document.addEventListener('mousemove', onMouseMove);
            // Notify parent
            eventBus.dispatchEvent(new CustomEvent('regionstart', {
                detail: { mouseX: e.clientX, mouseY: e.clientY },
            }));
        }
        function onMouseMove(e) {
            e.stopPropagation();
            // Notify parent
            eventBus.dispatchEvent(new CustomEvent('regionmove', {
                detail: { mouseX: e.clientX, mouseY: e.clientY },
            }));
        }
        function onMouseUp(e) {
            e.stopPropagation();
            document.removeEventListener('mouseup', onMouseUp);
            document.removeEventListener('mousemove', onMouseMove);
            // Notify parent
            eventBus.dispatchEvent(new CustomEvent('regionend', {
                detail: { mouseX: e.clientX, mouseY: e.clientY },
            }));
        }
    }
    /**
     * Attach event listeners for the overlay element.
     * Enables the creation of a new selection by dragging an empty area.
     */
    attachOverlayEvents() {
        const SOUTHEAST_HANDLE_IDX = 4;
        const self = this;
        let tmpBox = null;
        this.overlayEl.addEventListener('mousedown', onMouseDown);
        function onMouseDown(e) {
            e.stopPropagation();
            document.addEventListener('mouseup', onMouseUp);
            document.addEventListener('mousemove', onMouseMove);
            // Calculate mouse's position in relative to the container
            const container = self.cropperEl.getBoundingClientRect();
            const mouseX = e.clientX - container.left;
            const mouseY = e.clientY - container.top;
            // Create new box at mouse position
            tmpBox = self.box;
            self.box = new Box(mouseX, mouseY, mouseX + 1, mouseY + 1);
            // Activate the bottom right handle
            self.eventBus.dispatchEvent(new CustomEvent('handlestart', {
                detail: { handle: self.handles[SOUTHEAST_HANDLE_IDX] },
            }));
        }
        function onMouseMove(e) {
            e.stopPropagation();
            self.eventBus.dispatchEvent(new CustomEvent('handlemove', {
                detail: { mouseX: e.clientX, mouseY: e.clientY },
            }));
        }
        function onMouseUp(e) {
            e.stopPropagation();
            document.removeEventListener('mouseup', onMouseUp);
            document.removeEventListener('mousemove', onMouseMove);
            // If the new box has no width and height, it suggests that
            // the user had just clicked on an empty area and did not drag
            // a new box (ie. an accidental click). In this scenario, we
            // simply replace it with the previous box.
            if (self.box.width() === 1 && self.box.height() === 1) {
                self.box = tmpBox;
                return;
            }
            self.eventBus.dispatchEvent(new CustomEvent('handleend', {
                detail: { mouseX: e.clientX, mouseY: e.clientY },
            }));
        }
    }
    /**
     * EVENT HANDLER
     * Executes when user begins dragging a handle.
     */
    onHandleMoveStart(e) {
        let handle = e.detail.handle;
        // The origin point is the point where the box is scaled from.
        // This is usually the opposite side/corner of the active handle.
        const originPoint = [1 - handle.position[0], 1 - handle.position[1]];
        let [originX, originY] = this.box.getAbsolutePoint(originPoint);
        this.activeHandle = { handle, originPoint, originX, originY };
        // Trigger callback
        if (this.options.onCropStart !== null) {
            this.options.onCropStart(this.getValue());
        }
    }
    /**
     * EVENT HANDLER
     * Executes on handle move. Main logic to manage the movement of handles.
     */
    onHandleMoveMoving(e) {
        let { mouseX, mouseY } = e.detail;
        // Calculate mouse's position in relative to the container
        let container = this.cropperEl.getBoundingClientRect();
        mouseX = mouseX - container.left;
        mouseY = mouseY - container.top;
        // Ensure mouse is within the boundaries
        if (mouseX < 0) {
            mouseX = 0;
        }
        else if (mouseX > container.width) {
            mouseX = container.width;
        }
        if (mouseY < 0) {
            mouseY = 0;
        }
        else if (mouseY > container.height) {
            mouseY = container.height;
        }
        // Bootstrap helper variables
        let origin = this.activeHandle.originPoint.slice();
        const originX = this.activeHandle.originX;
        const originY = this.activeHandle.originY;
        const handle = this.activeHandle.handle;
        const TOP_MOVABLE = handle.constraints[0] === 1;
        const RIGHT_MOVABLE = handle.constraints[1] === 1;
        const BOTTOM_MOVABLE = handle.constraints[2] === 1;
        const LEFT_MOVABLE = handle.constraints[3] === 1;
        const MULTI_AXIS = (LEFT_MOVABLE || RIGHT_MOVABLE) && (TOP_MOVABLE || BOTTOM_MOVABLE);
        // Apply movement to respective sides according to the handle's
        // constraint values.
        let x1 = LEFT_MOVABLE || RIGHT_MOVABLE ? originX : this.box.x1;
        let x2 = LEFT_MOVABLE || RIGHT_MOVABLE ? originX : this.box.x2;
        let y1 = TOP_MOVABLE || BOTTOM_MOVABLE ? originY : this.box.y1;
        let y2 = TOP_MOVABLE || BOTTOM_MOVABLE ? originY : this.box.y2;
        x1 = LEFT_MOVABLE ? mouseX : x1;
        x2 = RIGHT_MOVABLE ? mouseX : x2;
        y1 = TOP_MOVABLE ? mouseY : y1;
        y2 = BOTTOM_MOVABLE ? mouseY : y2;
        // Check if the user dragged past the origin point. If it did,
        // we set the flipped flag to true.
        let [isFlippedX, isFlippedY] = [false, false];
        if (LEFT_MOVABLE || RIGHT_MOVABLE) {
            isFlippedX = LEFT_MOVABLE ? mouseX > originX : mouseX < originX;
        }
        if (TOP_MOVABLE || BOTTOM_MOVABLE) {
            isFlippedY = TOP_MOVABLE ? mouseY > originY : mouseY < originY;
        }
        // If it is flipped, we swap the coordinates and flip the origin point.
        if (isFlippedX) {
            const tmp = x1;
            x1 = x2;
            x2 = tmp; // Swap x1 and x2
            origin[0] = 1 - origin[0]; // Flip origin x point
        }
        if (isFlippedY) {
            const tmp = y1;
            y1 = y2;
            y2 = tmp; // Swap y1 and y2
            origin[1] = 1 - origin[1]; // Flip origin y point
        }
        // Create new box object
        let box = new Box(x1, y1, x2, y2);
        // Maintain aspect ratio
        if (this.options.aspectRatio) {
            const ratio = this.options.aspectRatio;
            let isVerticalMovement = false;
            if (MULTI_AXIS) {
                isVerticalMovement = mouseY > box.y1 + ratio * box.width() || mouseY < box.y2 - ratio * box.width();
            }
            else if (TOP_MOVABLE || BOTTOM_MOVABLE) {
                isVerticalMovement = true;
            }
            const ratioMode = isVerticalMovement ? 'width' : 'height';
            box.constrainToRatio(ratio, origin, ratioMode);
        }
        // Maintain minimum/maximum size
        const min = this.options.minSize;
        const max = this.options.maxSize;
        box.constrainToSize(max.width, max.height, min.width, min.height, origin, this.options.aspectRatio);
        // Constrain to boundary
        const parentWidth = this.cropperEl.offsetWidth;
        const parentHeight = this.cropperEl.offsetHeight;
        box.constrainToBoundary(parentWidth, parentHeight, origin);
        // Finally, update the visuals (border, handles, clipped image, etc)
        this.box = box;
        this.redraw();
        // Trigger callback
        if (this.options.onCropMove !== null) {
            this.options.onCropMove(this.getValue());
        }
    }
    /**
     * EVENT HANDLER
     * Executes on handle move end.
     */
    onHandleMoveEnd(e) {
        // Trigger callback
        if (this.options.onCropEnd !== null) {
            this.options.onCropEnd(this.getValue());
        }
    }
    /**
     * EVENT HANDLER
     * Executes when user starts moving the crop region.
     */
    onRegionMoveStart(e) {
        let { mouseX, mouseY } = e.detail;
        // Calculate mouse's position in relative to the container
        let container = this.cropperEl.getBoundingClientRect();
        mouseX = mouseX - container.left;
        mouseY = mouseY - container.top;
        this.currentMove = {
            offsetX: mouseX - this.box.x1,
            offsetY: mouseY - this.box.y1,
        };
        // Trigger callback
        if (this.options.onCropStart !== null) {
            this.options.onCropStart(this.getValue());
        }
    }
    /**
     * EVENT HANDLER
     * Executes when user moves the crop region.
     */
    onRegionMoveMoving(e) {
        let { mouseX, mouseY } = e.detail;
        let { offsetX, offsetY } = this.currentMove;
        // Calculate mouse's position in relative to the container
        let container = this.cropperEl.getBoundingClientRect();
        mouseX = mouseX - container.left;
        mouseY = mouseY - container.top;
        this.box.move(mouseX - offsetX, mouseY - offsetY);
        // Ensure box is within the boundaries
        if (this.box.x1 < 0) {
            this.box.move(0, null);
        }
        if (this.box.x2 > container.width) {
            this.box.move(container.width - this.box.width(), null);
        }
        if (this.box.y1 < 0) {
            this.box.move(null, 0);
        }
        if (this.box.y2 > container.height) {
            this.box.move(null, container.height - this.box.height());
        }
        // Update visuals
        this.redraw();
        // Trigger callback
        if (this.options.onCropMove !== null) {
            this.options.onCropMove(this.getValue());
        }
    }
    /**
     * EVENT HANDLER
     * Executes when user stops moving the crop region (mouse up).
     */
    onRegionMoveEnd(e) {
        // Trigger callback
        if (this.options.onCropEnd !== null) {
            this.options.onCropEnd(this.getValue());
        }
    }
    /**
     * Calculate the value of the crop region.
     */
    getValue(mode = null) {
        if (mode === null) {
            mode = this.options.returnMode;
        }
        if (mode == 'real') {
            const actualWidth = this.imageEl.naturalWidth;
            const actualHeight = this.imageEl.naturalHeight;
            const { width: elementWidth, height: elementHeight } = this.imageEl.getBoundingClientRect();
            const factorX = actualWidth / elementWidth;
            const factorY = actualHeight / elementHeight;
            return {
                x: Math.round(this.box.x1 * factorX),
                y: Math.round(this.box.y1 * factorY),
                width: Math.round(this.box.width() * factorX),
                height: Math.round(this.box.height() * factorY),
            };
        }
        else if (mode == 'ratio') {
            const { width: elementWidth, height: elementHeight } = this.imageEl.getBoundingClientRect();
            return {
                x: round(this.box.x1 / elementWidth, 3),
                y: round(this.box.y1 / elementHeight, 3),
                width: round(this.box.width() / elementWidth, 3),
                height: round(this.box.height() / elementHeight, 3),
            };
        }
        else if (mode == 'raw') {
            return {
                x: Math.round(this.box.x1),
                y: Math.round(this.box.y1),
                width: Math.round(this.box.width()),
                height: Math.round(this.box.height()),
            };
        }
    }
    /**
     * Parse user options and set default values.
     */
    static parseOptions(opts) {
        const defaults = {
            aspectRatio: null,
            maxSize: { width: null, height: null },
            minSize: { width: null, height: null },
            startSize: { width: 100, height: 100, unit: '%' },
            returnMode: 'real',
            onInitialize: null,
            onCropStart: null,
            onCropMove: null,
            onCropEnd: null,
        };
        // Parse aspect ratio
        let aspectRatio = null;
        if (opts.aspectRatio !== undefined) {
            if (typeof opts.aspectRatio === 'number') {
                aspectRatio = opts.aspectRatio;
            }
            else if (opts.aspectRatio instanceof Array) {
                aspectRatio = opts.aspectRatio[1] / opts.aspectRatio[0];
            }
        }
        // Parse max width/height
        let maxSize = null;
        if (opts.maxSize !== undefined && opts.maxSize !== null) {
            maxSize = {
                width: opts.maxSize[0] || null,
                height: opts.maxSize[1] || null,
                unit: opts.maxSize[2] || 'px',
            };
        }
        // Parse min width/height
        let minSize = null;
        if (opts.minSize !== undefined && opts.minSize !== null) {
            minSize = {
                width: opts.minSize[0] || null,
                height: opts.minSize[1] || null,
                unit: opts.minSize[2] || 'px',
            };
        }
        // Parse start size
        let startSize = null;
        if (opts.startSize !== undefined && opts.startSize !== null) {
            startSize = {
                width: opts.startSize[0] || null,
                height: opts.startSize[1] || null,
                unit: opts.startSize[2] || '%',
            };
        }
        // Parse callbacks
        let onInitialize = null;
        if (typeof opts.onInitialize === 'function') {
            onInitialize = opts.onInitialize;
        }
        let onCropStart = null;
        if (typeof opts.onCropStart === 'function') {
            onCropStart = opts.onCropStart;
        }
        let onCropEnd = null;
        if (typeof opts.onCropEnd === 'function') {
            onCropEnd = opts.onCropEnd;
        }
        let onCropMove = null;
        if (typeof opts.onUpdate === 'function') {
            // DEPRECATED: onUpdate is deprecated to create a more uniform
            // callback API, such as: onCropStart, onCropMove, onCropEnd
            console.warn('Croppr.js: `onUpdate` is deprecated and will be removed in the next major release. Please use `onCropMove` or `onCropEnd` instead.');
            onCropMove = opts.onUpdate;
        }
        if (typeof opts.onCropMove === 'function') {
            onCropMove = opts.onCropMove;
        }
        // Parse returnMode value
        let returnMode = null;
        if (opts.returnMode !== undefined) {
            const s = opts.returnMode.toLowerCase();
            if (['real', 'ratio', 'raw'].indexOf(s) === -1) {
                throw 'Invalid return mode.';
            }
            returnMode = s;
        }
        // Create function to convert % values to pixels
        const convertToPixels = function (container) {
            const width = container.offsetWidth;
            const height = container.offsetHeight;
            // Convert sizes
            const sizeKeys = ['maxSize', 'minSize', 'startSize'];
            for (let i = 0; i < sizeKeys.length; i++) {
                const key = sizeKeys[i];
                if (this[key] !== null) {
                    if (this[key].unit == '%') {
                        if (this[key].width !== null) {
                            this[key].width = (this[key].width / 100) * width;
                        }
                        if (this[key].height !== null) {
                            this[key].height = (this[key].height / 100) * height;
                        }
                    }
                    delete this[key].unit;
                }
            }
        };
        const defaultValue = (v, d) => (v !== null ? v : d);
        return {
            aspectRatio: defaultValue(aspectRatio, defaults.aspectRatio),
            maxSize: defaultValue(maxSize, defaults.maxSize),
            minSize: defaultValue(minSize, defaults.minSize),
            startSize: defaultValue(startSize, defaults.startSize),
            returnMode: defaultValue(returnMode, defaults.returnMode),
            onInitialize: defaultValue(onInitialize, defaults.onInitialize),
            onCropStart: defaultValue(onCropStart, defaults.onCropStart),
            onCropMove: defaultValue(onCropMove, defaults.onCropMove),
            onCropEnd: defaultValue(onCropEnd, defaults.onCropEnd),
            convertToPixels: convertToPixels,
        };
    }
}
/**
 * HELPER FUNCTIONS
 */
function round(value, decimals) {
    return Number(Math.round((value + 'e' + decimals)) + 'e-' + decimals);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25ncC1pbWFnZS1waWNrZXIvc3JjL2xpYi9mdW5jdGlvbnMvY3JvcHByL2NvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBRUgsT0FBTyxNQUFNLE1BQU0sVUFBVSxDQUFDO0FBQzlCLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQztBQUN4QixPQUFPLFdBQVcsTUFBTSxTQUFTLENBQUM7QUFFbEM7Ozs7Ozs7OztHQVNHO0FBQ0gsTUFBTSxPQUFPLEdBQUc7SUFDZCxFQUFFLFFBQVEsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFO0lBQ3hFLEVBQUUsUUFBUSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUU7SUFDdkUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRTtJQUN4RSxFQUFFLFFBQVEsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFO0lBQ3ZFLEVBQUUsUUFBUSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsRUFB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UUFBYTtJQUN0QyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxHQUFHLEdBQUcsR0FBRyxRQUFRLENBQVEsQ0FBQyxHQUFHLElBQUksR0FBRyxRQUFRLENBQUMsQ0FBQztBQUMvRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcm9wcHJDb3JlXG4gKiBIZXJlIGxpZXMgdGhlIG1haW4gbG9naWMuXG4gKi9cblxuaW1wb3J0IEhhbmRsZSBmcm9tICcuL2hhbmRsZSc7XG5pbXBvcnQgQm94IGZyb20gJy4vYm94JztcbmltcG9ydCBlbmFibGVUb3VjaCBmcm9tICcuL3RvdWNoJztcblxuLyoqXG4gKiBEZWZpbmUgYSBsaXN0IG9mIGhhbmRsZXMgdG8gY3JlYXRlLlxuICpcbiAqIEBwcm9wZXJ0eSB7QXJyYXl9IHBvc2l0aW9uIC0gVGhlIHggYW5kIHkgcmF0aW8gcG9zaXRpb24gb2YgdGhlIGhhbmRsZSB3aXRoaW5cbiAqICAgICAgdGhlIGNyb3AgcmVnaW9uLiBBY2NlcHRzIGEgdmFsdWUgYmV0d2VlbiAwIHRvIDEgaW4gdGhlIG9yZGVyIG9mIFtYLCBZXS5cbiAqIEBwcm9wZXJ0eSB7QXJyYXl9IGNvbnN0cmFpbnRzIC0gRGVmaW5lIHRoZSBzaWRlIG9mIHRoZSBjcm9wIHJlZ2lvbiB0aGF0IGlzIHRvXG4gKiAgICAgIGJlIGFmZmVjdGVkIGJ5IHRoaXMgaGFuZGxlLiBBY2NlcHRzIGEgdmFsdWUgb2YgMCBvciAxIGluIHRoZSBvcmRlciBvZlxuICogICAgICBbVE9QLCBSSUdIVCwgQk9UVE9NLCBMRUZUXS5cbiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBjdXJzb3IgLSBUaGUgQ1NTIGN1cnNvciBvZiB0aGlzIGhhbmRsZS5cbiAqL1xuY29uc3QgSEFORExFUyA9IFtcbiAgeyBwb3NpdGlvbjogWzAuMCwgMC4wXSwgY29uc3RyYWludHM6IFsxLCAwLCAwLCAxXSwgY3Vyc29yOiAnbnctcmVzaXplJyB9LFxuICB7IHBvc2l0aW9uOiBbMC41LCAwLjBdLCBjb25zdHJhaW50czogWzEsIDAsIDAsIDBdLCBjdXJzb3I6ICduLXJlc2l6ZScgfSxcbiAgeyBwb3NpdGlvbjogWzEuMCwgMC4wXSwgY29uc3RyYWludHM6IFsxLCAxLCAwLCAwXSwgY3Vyc29yOiAnbmUtcmVzaXplJyB9LFxuICB7IHBvc2l0aW9uOiBbMS4wLCAwLjVdLCBjb25zdHJhaW50czogWzAsIDEsIDAsIDBdLCBjdXJzb3I6ICdlLXJlc2l6ZScgfSxcbiAgeyBwb3NpdGlvbjogWzEuMCwgMS4wXSwgY29uc3RyYWludHM6IFswLCAxLCAxLCAwXSwgY3Vyc29yOiAnc2UtcmVzaXplJyB9LFxuICB7IHBvc2l0aW9uOiBbMC41LCAxLjBdLCBjb25zdHJhaW50czogWzAsIDAsIDEsIDBdLCBjdXJzb3I6ICdzLXJlc2l6ZScgfSxcbiAgeyBwb3NpdGlvbjogWzAuMCwgMS4wXSwgY29uc3RyYWludHM6IFswLCAwLCAxLCAxXSwgY3Vyc29yOiAnc3ctcmVzaXplJyB9LFxuICB7IHBvc2l0aW9uOiBbMC4wLCAwLjVdLCBjb25zdHJhaW50czogWzAsIDAsIDAsIDFdLCBjdXJzb3I6ICd3LXJlc2l6ZScgfSxcbl07XG5cbi8qKlxuICogQ29yZSBjbGFzcyBmb3IgQ3JvcHByIGNvbnRhaW5pbmcgbW9zdCBvZiBpdHMgZnVuY3Rpb25hbCBsb2dpYy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3JvcHByQ29yZSB7XG4gIG9wdGlvbnM6IGFueTtcbiAgX2luaXRpYWxpemVkOiBhbnk7XG4gIF9yZXN0b3JlOiBhbnk7XG4gIGNyb3BwZXJFbDogYW55O1xuICBib3g6IGFueTtcbiAgY29udGFpbmVyRWw6IGFueTtcbiAgaW1hZ2VFbDogYW55O1xuICBldmVudEJ1czogYW55O1xuICBpbWFnZUNsaXBwZWRFbDogYW55O1xuICByZWdpb25FbDogSFRNTEVsZW1lbnQgfCBudWxsIHwgdW5kZWZpbmVkID0gbnVsbDtcbiAgb3ZlcmxheUVsOiBhbnk7XG4gIGhhbmRsZXM6IGFueTtcbiAgYWN0aXZlSGFuZGxlOiBhbnk7XG4gIGN1cnJlbnRNb3ZlOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoZWxlbWVudDogYW55LCBvcHRpb25zOiBhbnksIGRlZmVycmVkID0gZmFsc2UpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcIvCfmoAgfiBmaWxlOiBjb3JlLnRzIH4gbGluZSA1MSB+IENyb3BwckNvcmUgfiBjb25zdHJ1Y3RvciB+IGVsZW1lbnRcIiwgZWxlbWVudClcbiAgICAvLyBQYXJzZSBvcHRpb25zXG4gICAgdGhpcy5vcHRpb25zID0gQ3JvcHByQ29yZS5wYXJzZU9wdGlvbnMob3B0aW9ucyB8fCB7fSk7XG5cbiAgICAvLyBHZXQgdGFyZ2V0IGltZyBlbGVtZW50XG4gICAgaWYgKCFlbGVtZW50Lm5vZGVOYW1lKSB7XG4gICAgICBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50KTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwi8J+agCB+IGZpbGU6IGNvcmUudHMgfiBsaW5lIDU4IH4gQ3JvcHByQ29yZSB+IGNvbnN0cnVjdG9yIH4gZWxlbWVudFwiLCBlbGVtZW50KVxuICAgICAgaWYgKGVsZW1lbnQgPT0gbnVsbCkge1xuICAgICAgICB0aHJvdyAnVW5hYmxlIHRvIGZpbmQgZWxlbWVudC4nO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWVsZW1lbnQuZ2V0QXR0cmlidXRlKCdzcmMnKSkge1xuICAgICAgdGhyb3cgJ0ltYWdlIHNyYyBub3QgcHJvdmlkZWQuJztcbiAgICB9XG5cbiAgICAvLyBEZWZpbmUgaW50ZXJuYWwgcHJvcHNcbiAgICB0aGlzLl9pbml0aWFsaXplZCA9IGZhbHNlO1xuICAgIHRoaXMuX3Jlc3RvcmUgPSB7XG4gICAgICBwYXJlbnQ6IGVsZW1lbnQucGFyZW50Tm9kZSxcbiAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgfTtcblxuICAgIC8vIFdhaXQgdW50aWwgaW1hZ2UgaXMgbG9hZGVkIGJlZm9yZSBwcm9jZWVkaW5nXG4gICAgaWYgKCFkZWZlcnJlZCkge1xuICAgICAgaWYgKGVsZW1lbnQud2lkdGggPT09IDAgfHwgZWxlbWVudC5oZWlnaHQgPT09IDApIHtcbiAgICAgICAgZWxlbWVudC5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5pbml0aWFsaXplKGVsZW1lbnQpO1xuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplKGVsZW1lbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBDcm9wcHIgaW5zdGFuY2VcbiAgICovXG4gIGluaXRpYWxpemUoZWxlbWVudDogYW55KSB7XG4gICAgLy8gQ3JlYXRlIERPTSBlbGVtZW50c1xuICAgIHRoaXMuY3JlYXRlRE9NKGVsZW1lbnQpO1xuXG4gICAgLy8gUHJvY2VzcyBvcHRpb24gdmFsdWVzXG4gICAgdGhpcy5vcHRpb25zLmNvbnZlcnRUb1BpeGVscyh0aGlzLmNyb3BwZXJFbCk7XG5cbiAgICAvLyBMaXN0ZW4gZm9yIGV2ZW50cyBmcm9tIGNoaWxkcmVuXG4gICAgdGhpcy5hdHRhY2hIYW5kbGVyRXZlbnRzKCk7XG4gICAgdGhpcy5hdHRhY2hSZWdpb25FdmVudHMoKTtcbiAgICB0aGlzLmF0dGFjaE92ZXJsYXlFdmVudHMoKTtcblxuICAgIC8vIEJvb3RzdHJhcCB0aGlzIGNyb3BwZXIgaW5zdGFuY2VcbiAgICB0aGlzLmJveCA9IHRoaXMuaW5pdGlhbGl6ZUJveCh0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMucmVkcmF3KCk7XG5cbiAgICAvLyBTZXQgdGhlIGluaXRhbGl6ZWQgZmxhZyB0byB0cnVlIGFuZCBjYWxsIHRoZSBjYWxsYmFja1xuICAgIHRoaXMuX2luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5vcHRpb25zLm9uSW5pdGlhbGl6ZSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5vcHRpb25zLm9uSW5pdGlhbGl6ZSh0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIENyb3BwcidzIERPTSBlbGVtZW50c1xuICAgKi9cbiAgY3JlYXRlRE9NKHRhcmdldEVsOiBhbnkpIHtcbiAgICAvLyBDcmVhdGUgbWFpbiBjb250YWluZXIgYW5kIHVzZSBpdCBhcyB0aGUgbWFpbiBldmVudCBsaXN0ZW5lcnNcbiAgICB0aGlzLmNvbnRhaW5lckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5jb250YWluZXJFbC5jbGFzc05hbWUgPSAnY3JvcHByLWNvbnRhaW5lcic7XG4gICAgdGhpcy5ldmVudEJ1cyA9IHRoaXMuY29udGFpbmVyRWw7XG4gICAgZW5hYmxlVG91Y2godGhpcy5jb250YWluZXJFbCk7XG5cbiAgICAvLyBDcmVhdGUgY3JvcHBlciBlbGVtZW50XG4gICAgdGhpcy5jcm9wcGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmNyb3BwZXJFbC5jbGFzc05hbWUgPSAnY3JvcHByJztcblxuICAgIC8vIENyZWF0ZSBpbWFnZSBlbGVtZW50XG4gICAgdGhpcy5pbWFnZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgdGhpcy5pbWFnZUVsLnNldEF0dHJpYnV0ZSgnc3JjJywgdGFyZ2V0RWwuZ2V0QXR0cmlidXRlKCdzcmMnKSk7XG4gICAgdGhpcy5pbWFnZUVsLnNldEF0dHJpYnV0ZSgnYWx0JywgdGFyZ2V0RWwuZ2V0QXR0cmlidXRlKCdhbHQnKSk7XG4gICAgdGhpcy5pbWFnZUVsLmNsYXNzTmFtZSA9ICdjcm9wcHItaW1hZ2UnO1xuXG4gICAgLy8gQ3JlYXRlIGNsaXBwZWQgaW1hZ2UgZWxlbWVudFxuICAgIHRoaXMuaW1hZ2VDbGlwcGVkRWwgPSB0aGlzLmltYWdlRWwuY2xvbmVOb2RlKCk7XG4gICAgdGhpcy5pbWFnZUNsaXBwZWRFbC5jbGFzc05hbWUgPSAnY3JvcHByLWltYWdlQ2xpcHBlZCc7XG5cbiAgICAvLyBDcmVhdGUgcmVnaW9uIGJveCBlbGVtZW50XG4gICAgdGhpcy5yZWdpb25FbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMucmVnaW9uRWwuaW5uZXJIVE1MID0gbmV3IEFycmF5KDkpXG4gICAgICAuZmlsbCgxKVxuICAgICAgLm1hcCgoKSA9PiBgPGRpdiBzdHlsZT1cImJvcmRlcjogMXB4IGRhc2hlZCAjZmFmYWZhXCI+PC9kaXY+YClcbiAgICAgIC5qb2luKCcnKTtcbiAgICB0aGlzLnJlZ2lvbkVsLmNsYXNzTmFtZSA9ICdjcm9wcHItcmVnaW9uJztcblxuICAgIC8vIENyZWF0ZSBvdmVybGF5IGVsZW1lbnRcbiAgICB0aGlzLm92ZXJsYXlFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMub3ZlcmxheUVsLmNsYXNzTmFtZSA9ICdjcm9wcHItb3ZlcmxheSc7XG5cbiAgICAvLyBDcmVhdGUgaGFuZGxlcyBlbGVtZW50XG4gICAgbGV0IGhhbmRsZUNvbnRhaW5lckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgaGFuZGxlQ29udGFpbmVyRWwuY2xhc3NOYW1lID0gJ2Nyb3Bwci1oYW5kbGVDb250YWluZXInO1xuICAgIHRoaXMuaGFuZGxlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgSEFORExFUy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaGFuZGxlID0gbmV3IEhhbmRsZShIQU5ETEVTW2ldLnBvc2l0aW9uLCBIQU5ETEVTW2ldLmNvbnN0cmFpbnRzLCBIQU5ETEVTW2ldLmN1cnNvciwgdGhpcy5ldmVudEJ1cyk7XG4gICAgICB0aGlzLmhhbmRsZXMucHVzaChoYW5kbGUpO1xuICAgICAgaGFuZGxlQ29udGFpbmVyRWwuYXBwZW5kQ2hpbGQoaGFuZGxlLmVsKTtcbiAgICB9XG5cbiAgICAvLyBBbmQgdGhlbiB3ZSBwaWVjZSBpdCBhbGwgdG9nZXRoZXIhXG4gICAgdGhpcy5jcm9wcGVyRWwuYXBwZW5kQ2hpbGQodGhpcy5pbWFnZUVsKTtcbiAgICB0aGlzLmNyb3BwZXJFbC5hcHBlbmRDaGlsZCh0aGlzLmltYWdlQ2xpcHBlZEVsKTtcbiAgICB0aGlzLmNyb3BwZXJFbC5hcHBlbmRDaGlsZCh0aGlzLnJlZ2lvbkVsKTtcbiAgICB0aGlzLmNyb3BwZXJFbC5hcHBlbmRDaGlsZCh0aGlzLm92ZXJsYXlFbCk7XG4gICAgdGhpcy5jcm9wcGVyRWwuYXBwZW5kQ2hpbGQoaGFuZGxlQ29udGFpbmVyRWwpO1xuICAgIHRoaXMuY29udGFpbmVyRWwuYXBwZW5kQ2hpbGQodGhpcy5jcm9wcGVyRWwpO1xuXG4gICAgLy8gQW5kIHRoZW4gZmluYWxseSBpbnNlcnQgaXQgaW50byB0aGUgZG9jdW1lbnRcbiAgICB0YXJnZXRFbC5wYXJlbnRFbGVtZW50LnJlcGxhY2VDaGlsZCh0aGlzLmNvbnRhaW5lckVsLCB0YXJnZXRFbCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hhbmdlcyB0aGUgaW1hZ2Ugc3JjLlxuICAgKiBAcGFyYW0ge1N0cmluZ30gc3JjXG4gICAqL1xuICBzZXRJbWFnZShzcmM6IGFueSkge1xuICAgIC8vIEFkZCBvbmxvYWQgbGlzdGVuZXIgdG8gcmVpbml0aWFsaXplIGJveFxuICAgIHRoaXMuaW1hZ2VFbC5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICB0aGlzLmJveCA9IHRoaXMuaW5pdGlhbGl6ZUJveCh0aGlzLm9wdGlvbnMpO1xuICAgICAgdGhpcy5yZWRyYXcoKTtcbiAgICB9O1xuXG4gICAgLy8gQ2hhbmdlIGltYWdlIHNvdXJjZVxuICAgIHRoaXMuaW1hZ2VFbC5zcmMgPSBzcmM7XG4gICAgdGhpcy5pbWFnZUNsaXBwZWRFbC5zcmMgPSBzcmM7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogRGVzdHJveSB0aGUgQ3JvcHByIGluc3RhbmNlIGFuZCByZXBsYWNlIHdpdGggdGhlIG9yaWdpbmFsIGVsZW1lbnQuXG4gICAqL1xuICBkZXN0cm95KCkge1xuICAgIHRoaXMuX3Jlc3RvcmUucGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLl9yZXN0b3JlLmVsZW1lbnQsIHRoaXMuY29udGFpbmVyRWwpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBib3ggcmVnaW9uIHdpdGggYSBzZXQgb2Ygb3B0aW9ucy5cbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdHMgVGhlIG9wdGlvbnMuXG4gICAqIEByZXR1cm5zIHtCb3h9XG4gICAqL1xuICBpbml0aWFsaXplQm94KG9wdHM6IGFueSkge1xuICAgIC8vIENyZWF0ZSBpbml0aWFsIGJveFxuICAgIGNvbnN0IHdpZHRoID0gb3B0cy5zdGFydFNpemUud2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gb3B0cy5zdGFydFNpemUuaGVpZ2h0O1xuICAgIGxldCBib3ggPSBuZXcgQm94KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwi8J+agCB+IGZpbGU6IGNvcmUudHMgfiBsaW5lIDIwMiB+IENyb3BwckNvcmUgfiBpbml0aWFsaXplQm94IH4gYm94XCIsIGJveClcblxuICAgIC8vIE1haW50YWluIHJhdGlvXG4gICAgYm94LmNvbnN0cmFpblRvUmF0aW8ob3B0cy5hc3BlY3RSYXRpbywgWzAuNSwgMC41XSk7XG5cbiAgICAvLyBNYWludGFpbiBtaW5pbXVtL21heGltdW0gc2l6ZVxuICAgIGNvbnN0IG1pbiA9IG9wdHMubWluU2l6ZTtcbiAgICBjb25zdCBtYXggPSBvcHRzLm1heFNpemU7XG4gICAgYm94LmNvbnN0cmFpblRvU2l6ZShtYXgud2lkdGgsIG1heC5oZWlnaHQsIG1pbi53aWR0aCwgbWluLmhlaWdodCwgWzAuNSwgMC41XSwgb3B0cy5hc3BlY3RSYXRpbyk7XG5cbiAgICAvLyBDb25zdHJhaW4gdG8gYm91bmRhcnlcbiAgICBjb25zdCBwYXJlbnRXaWR0aCA9IHRoaXMuY3JvcHBlckVsLm9mZnNldFdpZHRoO1xuICAgIGNvbnN0IHBhcmVudEhlaWdodCA9IHRoaXMuY3JvcHBlckVsLm9mZnNldEhlaWdodDtcbiAgICBib3guY29uc3RyYWluVG9Cb3VuZGFyeShwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0LCBbMC41LCAwLjVdKTtcblxuICAgIC8vIC8vIE1vdmUgdG8gY2VudGVyXG4gICAgY29uc3QgeCA9IHRoaXMuY3JvcHBlckVsLm9mZnNldFdpZHRoIC8gMiAtIGJveC53aWR0aCgpIC8gMjtcbiAgICBjb25zdCB5ID0gdGhpcy5jcm9wcGVyRWwub2Zmc2V0SGVpZ2h0IC8gMiAtIGJveC5oZWlnaHQoKSAvIDI7XG5cbiAgICAvLyBjb25zb2xlLmxvZyhcIvCfmoAgfiBmaWxlOiBjb3JlLnRzIH4gbGluZSAyMTkgfiBDcm9wcHJDb3JlIH4gaW5pdGlhbGl6ZUJveCB+IHRoaXMuY3JvcHBlckVsXCIsIHRoaXMuY3JvcHBlckVsLm9mZnNldFdpZHRoKVxuICAgIC8vIGNvbnNvbGUubG9nKFwi8J+agCB+IGZpbGU6IGNvcmUudHMgfiBsaW5lIDIyMyB+IENyb3BwckNvcmUgfiBpbml0aWFsaXplQm94IH4geCwgeVwiLCB4LCB5KVxuICAgIGJveC5tb3ZlKHggYXMgYW55LCB5IGFzIGFueSk7XG5cbiAgICByZXR1cm4gYm94O1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgdmlzdWFscyAoYm9yZGVyLCBoYW5kbGVzLCBldGMpIGZvciB0aGUgY3VycmVudCBib3guXG4gICAqL1xuICByZWRyYXcoKSB7XG4gICAgLy8gUm91bmQgcG9zaXRpb25hbCB2YWx1ZXMgdG8gcHJldmVudCBzdWJwaXhlbCBjb29yZGluYXRlcywgd2hpY2ggY2FuXG4gICAgLy8gcmVzdWx0IGluIGVsZW1lbnQgdGhhdCBpcyByZW5kZXJlZCBibHVybHlcbiAgICBjb25zdCB3aWR0aCA9IE1hdGgucm91bmQodGhpcy5ib3gud2lkdGgoKSksXG4gICAgICBoZWlnaHQgPSBNYXRoLnJvdW5kKHRoaXMuYm94LmhlaWdodCgpKSxcbiAgICAgIHgxID0gTWF0aC5yb3VuZCh0aGlzLmJveC54MSksXG4gICAgICB5MSA9IE1hdGgucm91bmQodGhpcy5ib3gueTEpLFxuICAgICAgeDIgPSBNYXRoLnJvdW5kKHRoaXMuYm94LngyKSxcbiAgICAgIHkyID0gTWF0aC5yb3VuZCh0aGlzLmJveC55Mik7XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIC8vIFVwZGF0ZSByZWdpb24gZWxlbWVudFxuICAgICAgaWYgKCF0aGlzLnJlZ2lvbkVsKSByZXR1cm47XG4gICAgICB0aGlzLnJlZ2lvbkVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHt4MX1weCwgJHt5MX1weClgO1xuICAgICAgdGhpcy5yZWdpb25FbC5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4JztcbiAgICAgIHRoaXMucmVnaW9uRWwuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JztcblxuICAgICAgLy8gVXBkYXRlIGNsaXBwZWQgaW1hZ2UgZWxlbWVudFxuICAgICAgdGhpcy5pbWFnZUNsaXBwZWRFbC5zdHlsZS5jbGlwID0gYHJlY3QoJHt5MX1weCwgJHt4Mn1weCwgJHt5Mn1weCwgJHt4MX1weClgO1xuXG4gICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggaGFuZGxlIHRvIGJyaW5nIGZvcndhcmQuIFRoZSBmb2xsb3dpbmcgY29kZVxuICAgICAgLy8gY2FsY3VsYXRlcyB0aGUgcXVhZHJhbnQgdGhlIGJveCBpcyBpbiB1c2luZyBiaXR3aXNlIG9wZXJhdG9ycy5cbiAgICAgIC8vIFJlZmVyZW5jZTogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvOTcxODA1OVxuICAgICAgY29uc3QgY2VudGVyID0gdGhpcy5ib3guZ2V0QWJzb2x1dGVQb2ludChbMC41LCAwLjVdKTtcbiAgICAgIGNvbnN0IHhTaWduID0gKGNlbnRlclswXSAtIHRoaXMuY3JvcHBlckVsLm9mZnNldFdpZHRoIC8gMikgPj4gMzE7XG4gICAgICBjb25zdCB5U2lnbiA9IChjZW50ZXJbMV0gLSB0aGlzLmNyb3BwZXJFbC5vZmZzZXRIZWlnaHQgLyAyKSA+PiAzMTtcbiAgICAgIGNvbnN0IHF1YWRyYW50ID0gKHhTaWduIF4geVNpZ24pICsgeVNpZ24gKyB5U2lnbiArIDQ7XG5cbiAgICAgIC8vIFRoZSBmb2xsb3dpbmcgZXF1YXRpb24gY2FsY3VsYXRlcyB3aGljaCBoYW5kbGUgaW5kZXggdG8gYnJpbmdcbiAgICAgIC8vIGZvcndhcmQuIFRoZSBlcXVhdGlvbiBpcyBkZXJpdmVkIHVzaW5nIGFsZ2VicmEgKGlmIHlvdXJlIGN1cmlvdXMpXG4gICAgICBjb25zdCBmb3JlZ3JvdW5kSGFuZGxlSW5kZXggPSAtMiAqIHF1YWRyYW50ICsgODtcblxuICAgICAgLy8gVXBkYXRlIGhhbmRsZSBwb3NpdGlvbnNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5oYW5kbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBoYW5kbGUgPSB0aGlzLmhhbmRsZXNbaV07XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIGhhbmRsZSBwb3NpdGlvblxuICAgICAgICBjb25zdCBoYW5kbGVXaWR0aCA9IGhhbmRsZS5lbC5vZmZzZXRXaWR0aDtcbiAgICAgICAgY29uc3QgaGFuZGxlSGVpZ2h0ID0gaGFuZGxlLmVsLm9mZnNldEhlaWdodDtcbiAgICAgICAgY29uc3QgbGVmdCA9IHgxICsgd2lkdGggKiBoYW5kbGUucG9zaXRpb25bMF0gLSBoYW5kbGVXaWR0aCAvIDI7XG4gICAgICAgIGNvbnN0IHRvcCA9IHkxICsgaGVpZ2h0ICogaGFuZGxlLnBvc2l0aW9uWzFdIC0gaGFuZGxlSGVpZ2h0IC8gMjtcblxuICAgICAgICAvLyBBcHBseSBuZXcgcG9zaXRpb24uIFRoZSBwb3NpdGlvbmFsIHZhbHVlcyBhcmUgcm91bmRlZCB0b1xuICAgICAgICAvLyBwcmV2ZW50IHN1YnBpeGVsIHBvc2l0aW9ucyB3aGljaCBjYW4gcmVzdWx0IGluIGEgYmx1cnJ5IGVsZW1lbnRcbiAgICAgICAgaGFuZGxlLmVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHtNYXRoLnJvdW5kKGxlZnQpfXB4LCAke01hdGgucm91bmQodG9wKX1weClgO1xuICAgICAgICBoYW5kbGUuZWwuc3R5bGUuekluZGV4ID0gZm9yZWdyb3VuZEhhbmRsZUluZGV4ID09IGkgPyA1IDogNDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2ggbGlzdGVuZXJzIGZvciBldmVudHMgZW1pdHRlZCBieSB0aGUgaGFuZGxlcy5cbiAgICogRW5hYmxlcyByZXNpemluZyBvZiB0aGUgcmVnaW9uIGVsZW1lbnQuXG4gICAqL1xuICBhdHRhY2hIYW5kbGVyRXZlbnRzKCkge1xuICAgIGNvbnN0IGV2ZW50QnVzID0gdGhpcy5ldmVudEJ1cztcbiAgICBldmVudEJ1cy5hZGRFdmVudExpc3RlbmVyKCdoYW5kbGVzdGFydCcsIHRoaXMub25IYW5kbGVNb3ZlU3RhcnQuYmluZCh0aGlzKSk7XG4gICAgZXZlbnRCdXMuYWRkRXZlbnRMaXN0ZW5lcignaGFuZGxlbW92ZScsIHRoaXMub25IYW5kbGVNb3ZlTW92aW5nLmJpbmQodGhpcykpO1xuICAgIGV2ZW50QnVzLmFkZEV2ZW50TGlzdGVuZXIoJ2hhbmRsZWVuZCcsIHRoaXMub25IYW5kbGVNb3ZlRW5kLmJpbmQodGhpcykpO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0dGFjaCBldmVudCBsaXN0ZW5lcnMgZm9yIHRoZSBjcm9wIHJlZ2lvbiBlbGVtZW50LlxuICAgKiBFbmFibGVzIGRyYWdnaW5nL21vdmluZyBvZiB0aGUgcmVnaW9uIGVsZW1lbnQuXG4gICAqL1xuICBhdHRhY2hSZWdpb25FdmVudHMoKSB7XG4gICAgY29uc3QgZXZlbnRCdXMgPSB0aGlzLmV2ZW50QnVzO1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGlmICghdGhpcy5yZWdpb25FbCkgcmV0dXJuO1xuICAgIHRoaXMucmVnaW9uRWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgb25Nb3VzZURvd24pO1xuICAgIGV2ZW50QnVzLmFkZEV2ZW50TGlzdGVuZXIoJ3JlZ2lvbnN0YXJ0JywgdGhpcy5vblJlZ2lvbk1vdmVTdGFydC5iaW5kKHRoaXMpKTtcbiAgICBldmVudEJ1cy5hZGRFdmVudExpc3RlbmVyKCdyZWdpb25tb3ZlJywgdGhpcy5vblJlZ2lvbk1vdmVNb3ZpbmcuYmluZCh0aGlzKSk7XG4gICAgZXZlbnRCdXMuYWRkRXZlbnRMaXN0ZW5lcigncmVnaW9uZW5kJywgdGhpcy5vblJlZ2lvbk1vdmVFbmQuYmluZCh0aGlzKSk7XG5cbiAgICBmdW5jdGlvbiBvbk1vdXNlRG93bihlOiBhbnkpIHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25Nb3VzZVVwKTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKTtcblxuICAgICAgLy8gTm90aWZ5IHBhcmVudFxuICAgICAgZXZlbnRCdXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgbmV3IEN1c3RvbUV2ZW50KCdyZWdpb25zdGFydCcsIHtcbiAgICAgICAgICBkZXRhaWw6IHsgbW91c2VYOiBlLmNsaWVudFgsIG1vdXNlWTogZS5jbGllbnRZIH0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbk1vdXNlTW92ZShlOiBhbnkpIHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIC8vIE5vdGlmeSBwYXJlbnRcbiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgIG5ldyBDdXN0b21FdmVudCgncmVnaW9ubW92ZScsIHtcbiAgICAgICAgICBkZXRhaWw6IHsgbW91c2VYOiBlLmNsaWVudFgsIG1vdXNlWTogZS5jbGllbnRZIH0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbk1vdXNlVXAoZTogYW55KSB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIG9uTW91c2VVcCk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSk7XG5cbiAgICAgIC8vIE5vdGlmeSBwYXJlbnRcbiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgIG5ldyBDdXN0b21FdmVudCgncmVnaW9uZW5kJywge1xuICAgICAgICAgIGRldGFpbDogeyBtb3VzZVg6IGUuY2xpZW50WCwgbW91c2VZOiBlLmNsaWVudFkgfSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2ggZXZlbnQgbGlzdGVuZXJzIGZvciB0aGUgb3ZlcmxheSBlbGVtZW50LlxuICAgKiBFbmFibGVzIHRoZSBjcmVhdGlvbiBvZiBhIG5ldyBzZWxlY3Rpb24gYnkgZHJhZ2dpbmcgYW4gZW1wdHkgYXJlYS5cbiAgICovXG4gIGF0dGFjaE92ZXJsYXlFdmVudHMoKSB7XG4gICAgY29uc3QgU09VVEhFQVNUX0hBTkRMRV9JRFggPSA0O1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGxldCB0bXBCb3g6IGFueSA9IG51bGw7XG4gICAgdGhpcy5vdmVybGF5RWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgb25Nb3VzZURvd24pO1xuXG4gICAgZnVuY3Rpb24gb25Nb3VzZURvd24oZTogYW55KSB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIG9uTW91c2VVcCk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBtb3VzZSdzIHBvc2l0aW9uIGluIHJlbGF0aXZlIHRvIHRoZSBjb250YWluZXJcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHNlbGYuY3JvcHBlckVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgbW91c2VYID0gZS5jbGllbnRYIC0gY29udGFpbmVyLmxlZnQ7XG4gICAgICBjb25zdCBtb3VzZVkgPSBlLmNsaWVudFkgLSBjb250YWluZXIudG9wO1xuXG4gICAgICAvLyBDcmVhdGUgbmV3IGJveCBhdCBtb3VzZSBwb3NpdGlvblxuICAgICAgdG1wQm94ID0gc2VsZi5ib3g7XG4gICAgICBzZWxmLmJveCA9IG5ldyBCb3gobW91c2VYLCBtb3VzZVksIG1vdXNlWCArIDEsIG1vdXNlWSArIDEpO1xuXG4gICAgICAvLyBBY3RpdmF0ZSB0aGUgYm90dG9tIHJpZ2h0IGhhbmRsZVxuICAgICAgc2VsZi5ldmVudEJ1cy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoJ2hhbmRsZXN0YXJ0Jywge1xuICAgICAgICAgIGRldGFpbDogeyBoYW5kbGU6IHNlbGYuaGFuZGxlc1tTT1VUSEVBU1RfSEFORExFX0lEWF0gfSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uTW91c2VNb3ZlKGU6IGFueSkge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHNlbGYuZXZlbnRCdXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgbmV3IEN1c3RvbUV2ZW50KCdoYW5kbGVtb3ZlJywge1xuICAgICAgICAgIGRldGFpbDogeyBtb3VzZVg6IGUuY2xpZW50WCwgbW91c2VZOiBlLmNsaWVudFkgfSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uTW91c2VVcChlOiBhbnkpIHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25Nb3VzZVVwKTtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKTtcblxuICAgICAgLy8gSWYgdGhlIG5ldyBib3ggaGFzIG5vIHdpZHRoIGFuZCBoZWlnaHQsIGl0IHN1Z2dlc3RzIHRoYXRcbiAgICAgIC8vIHRoZSB1c2VyIGhhZCBqdXN0IGNsaWNrZWQgb24gYW4gZW1wdHkgYXJlYSBhbmQgZGlkIG5vdCBkcmFnXG4gICAgICAvLyBhIG5ldyBib3ggKGllLiBhbiBhY2NpZGVudGFsIGNsaWNrKS4gSW4gdGhpcyBzY2VuYXJpbywgd2VcbiAgICAgIC8vIHNpbXBseSByZXBsYWNlIGl0IHdpdGggdGhlIHByZXZpb3VzIGJveC5cbiAgICAgIGlmIChzZWxmLmJveC53aWR0aCgpID09PSAxICYmIHNlbGYuYm94LmhlaWdodCgpID09PSAxKSB7XG4gICAgICAgIHNlbGYuYm94ID0gdG1wQm94O1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHNlbGYuZXZlbnRCdXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgbmV3IEN1c3RvbUV2ZW50KCdoYW5kbGVlbmQnLCB7XG4gICAgICAgICAgZGV0YWlsOiB7IG1vdXNlWDogZS5jbGllbnRYLCBtb3VzZVk6IGUuY2xpZW50WSB9LFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVWRU5UIEhBTkRMRVJcbiAgICogRXhlY3V0ZXMgd2hlbiB1c2VyIGJlZ2lucyBkcmFnZ2luZyBhIGhhbmRsZS5cbiAgICovXG4gIG9uSGFuZGxlTW92ZVN0YXJ0KGU6IGFueSkge1xuICAgIGxldCBoYW5kbGUgPSBlLmRldGFpbC5oYW5kbGU7XG5cbiAgICAvLyBUaGUgb3JpZ2luIHBvaW50IGlzIHRoZSBwb2ludCB3aGVyZSB0aGUgYm94IGlzIHNjYWxlZCBmcm9tLlxuICAgIC8vIFRoaXMgaXMgdXN1YWxseSB0aGUgb3Bwb3NpdGUgc2lkZS9jb3JuZXIgb2YgdGhlIGFjdGl2ZSBoYW5kbGUuXG4gICAgY29uc3Qgb3JpZ2luUG9pbnQgPSBbMSAtIGhhbmRsZS5wb3NpdGlvblswXSwgMSAtIGhhbmRsZS5wb3NpdGlvblsxXV07XG4gICAgbGV0IFtvcmlnaW5YLCBvcmlnaW5ZXSA9IHRoaXMuYm94LmdldEFic29sdXRlUG9pbnQob3JpZ2luUG9pbnQpO1xuXG4gICAgdGhpcy5hY3RpdmVIYW5kbGUgPSB7IGhhbmRsZSwgb3JpZ2luUG9pbnQsIG9yaWdpblgsIG9yaWdpblkgfTtcblxuICAgIC8vIFRyaWdnZXIgY2FsbGJhY2tcbiAgICBpZiAodGhpcy5vcHRpb25zLm9uQ3JvcFN0YXJ0ICE9PSBudWxsKSB7XG4gICAgICB0aGlzLm9wdGlvbnMub25Dcm9wU3RhcnQodGhpcy5nZXRWYWx1ZSgpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRVZFTlQgSEFORExFUlxuICAgKiBFeGVjdXRlcyBvbiBoYW5kbGUgbW92ZS4gTWFpbiBsb2dpYyB0byBtYW5hZ2UgdGhlIG1vdmVtZW50IG9mIGhhbmRsZXMuXG4gICAqL1xuICBvbkhhbmRsZU1vdmVNb3ZpbmcoZTogYW55KSB7XG4gICAgbGV0IHsgbW91c2VYLCBtb3VzZVkgfSA9IGUuZGV0YWlsO1xuXG4gICAgLy8gQ2FsY3VsYXRlIG1vdXNlJ3MgcG9zaXRpb24gaW4gcmVsYXRpdmUgdG8gdGhlIGNvbnRhaW5lclxuICAgIGxldCBjb250YWluZXIgPSB0aGlzLmNyb3BwZXJFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBtb3VzZVggPSBtb3VzZVggLSBjb250YWluZXIubGVmdDtcbiAgICBtb3VzZVkgPSBtb3VzZVkgLSBjb250YWluZXIudG9wO1xuXG4gICAgLy8gRW5zdXJlIG1vdXNlIGlzIHdpdGhpbiB0aGUgYm91bmRhcmllc1xuICAgIGlmIChtb3VzZVggPCAwKSB7XG4gICAgICBtb3VzZVggPSAwO1xuICAgIH0gZWxzZSBpZiAobW91c2VYID4gY29udGFpbmVyLndpZHRoKSB7XG4gICAgICBtb3VzZVggPSBjb250YWluZXIud2lkdGg7XG4gICAgfVxuXG4gICAgaWYgKG1vdXNlWSA8IDApIHtcbiAgICAgIG1vdXNlWSA9IDA7XG4gICAgfSBlbHNlIGlmIChtb3VzZVkgPiBjb250YWluZXIuaGVpZ2h0KSB7XG4gICAgICBtb3VzZVkgPSBjb250YWluZXIuaGVpZ2h0O1xuICAgIH1cblxuICAgIC8vIEJvb3RzdHJhcCBoZWxwZXIgdmFyaWFibGVzXG4gICAgbGV0IG9yaWdpbiA9IHRoaXMuYWN0aXZlSGFuZGxlLm9yaWdpblBvaW50LnNsaWNlKCk7XG4gICAgY29uc3Qgb3JpZ2luWCA9IHRoaXMuYWN0aXZlSGFuZGxlLm9yaWdpblg7XG4gICAgY29uc3Qgb3JpZ2luWSA9IHRoaXMuYWN0aXZlSGFuZGxlLm9yaWdpblk7XG4gICAgY29uc3QgaGFuZGxlID0gdGhpcy5hY3RpdmVIYW5kbGUuaGFuZGxlO1xuICAgIGNvbnN0IFRPUF9NT1ZBQkxFID0gaGFuZGxlLmNvbnN0cmFpbnRzWzBdID09PSAxO1xuICAgIGNvbnN0IFJJR0hUX01PVkFCTEUgPSBoYW5kbGUuY29uc3RyYWludHNbMV0gPT09IDE7XG4gICAgY29uc3QgQk9UVE9NX01PVkFCTEUgPSBoYW5kbGUuY29uc3RyYWludHNbMl0gPT09IDE7XG4gICAgY29uc3QgTEVGVF9NT1ZBQkxFID0gaGFuZGxlLmNvbnN0cmFpbnRzWzNdID09PSAxO1xuICAgIGNvbnN0IE1VTFRJX0FYSVMgPSAoTEVGVF9NT1ZBQkxFIHx8IFJJR0hUX01PVkFCTEUpICYmIChUT1BfTU9WQUJMRSB8fCBCT1RUT01fTU9WQUJMRSk7XG5cbiAgICAvLyBBcHBseSBtb3ZlbWVudCB0byByZXNwZWN0aXZlIHNpZGVzIGFjY29yZGluZyB0byB0aGUgaGFuZGxlJ3NcbiAgICAvLyBjb25zdHJhaW50IHZhbHVlcy5cbiAgICBsZXQgeDEgPSBMRUZUX01PVkFCTEUgfHwgUklHSFRfTU9WQUJMRSA/IG9yaWdpblggOiB0aGlzLmJveC54MTtcbiAgICBsZXQgeDIgPSBMRUZUX01PVkFCTEUgfHwgUklHSFRfTU9WQUJMRSA/IG9yaWdpblggOiB0aGlzLmJveC54MjtcbiAgICBsZXQgeTEgPSBUT1BfTU9WQUJMRSB8fCBCT1RUT01fTU9WQUJMRSA/IG9yaWdpblkgOiB0aGlzLmJveC55MTtcbiAgICBsZXQgeTIgPSBUT1BfTU9WQUJMRSB8fCBCT1RUT01fTU9WQUJMRSA/IG9yaWdpblkgOiB0aGlzLmJveC55MjtcbiAgICB4MSA9IExFRlRfTU9WQUJMRSA/IG1vdXNlWCA6IHgxO1xuICAgIHgyID0gUklHSFRfTU9WQUJMRSA/IG1vdXNlWCA6IHgyO1xuICAgIHkxID0gVE9QX01PVkFCTEUgPyBtb3VzZVkgOiB5MTtcbiAgICB5MiA9IEJPVFRPTV9NT1ZBQkxFID8gbW91c2VZIDogeTI7XG5cbiAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBkcmFnZ2VkIHBhc3QgdGhlIG9yaWdpbiBwb2ludC4gSWYgaXQgZGlkLFxuICAgIC8vIHdlIHNldCB0aGUgZmxpcHBlZCBmbGFnIHRvIHRydWUuXG4gICAgbGV0IFtpc0ZsaXBwZWRYLCBpc0ZsaXBwZWRZXSA9IFtmYWxzZSwgZmFsc2VdO1xuICAgIGlmIChMRUZUX01PVkFCTEUgfHwgUklHSFRfTU9WQUJMRSkge1xuICAgICAgaXNGbGlwcGVkWCA9IExFRlRfTU9WQUJMRSA/IG1vdXNlWCA+IG9yaWdpblggOiBtb3VzZVggPCBvcmlnaW5YO1xuICAgIH1cbiAgICBpZiAoVE9QX01PVkFCTEUgfHwgQk9UVE9NX01PVkFCTEUpIHtcbiAgICAgIGlzRmxpcHBlZFkgPSBUT1BfTU9WQUJMRSA/IG1vdXNlWSA+IG9yaWdpblkgOiBtb3VzZVkgPCBvcmlnaW5ZO1xuICAgIH1cblxuICAgIC8vIElmIGl0IGlzIGZsaXBwZWQsIHdlIHN3YXAgdGhlIGNvb3JkaW5hdGVzIGFuZCBmbGlwIHRoZSBvcmlnaW4gcG9pbnQuXG4gICAgaWYgKGlzRmxpcHBlZFgpIHtcbiAgICAgIGNvbnN0IHRtcCA9IHgxO1xuICAgICAgeDEgPSB4MjtcbiAgICAgIHgyID0gdG1wOyAvLyBTd2FwIHgxIGFuZCB4MlxuICAgICAgb3JpZ2luWzBdID0gMSAtIG9yaWdpblswXTsgLy8gRmxpcCBvcmlnaW4geCBwb2ludFxuICAgIH1cbiAgICBpZiAoaXNGbGlwcGVkWSkge1xuICAgICAgY29uc3QgdG1wID0geTE7XG4gICAgICB5MSA9IHkyO1xuICAgICAgeTIgPSB0bXA7IC8vIFN3YXAgeTEgYW5kIHkyXG4gICAgICBvcmlnaW5bMV0gPSAxIC0gb3JpZ2luWzFdOyAvLyBGbGlwIG9yaWdpbiB5IHBvaW50XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIG5ldyBib3ggb2JqZWN0XG4gICAgbGV0IGJveCA9IG5ldyBCb3goeDEsIHkxLCB4MiwgeTIpO1xuXG4gICAgLy8gTWFpbnRhaW4gYXNwZWN0IHJhdGlvXG4gICAgaWYgKHRoaXMub3B0aW9ucy5hc3BlY3RSYXRpbykge1xuICAgICAgY29uc3QgcmF0aW8gPSB0aGlzLm9wdGlvbnMuYXNwZWN0UmF0aW87XG4gICAgICBsZXQgaXNWZXJ0aWNhbE1vdmVtZW50ID0gZmFsc2U7XG4gICAgICBpZiAoTVVMVElfQVhJUykge1xuICAgICAgICBpc1ZlcnRpY2FsTW92ZW1lbnQgPSBtb3VzZVkgPiBib3gueTEgKyByYXRpbyAqIGJveC53aWR0aCgpIHx8IG1vdXNlWSA8IGJveC55MiAtIHJhdGlvICogYm94LndpZHRoKCk7XG4gICAgICB9IGVsc2UgaWYgKFRPUF9NT1ZBQkxFIHx8IEJPVFRPTV9NT1ZBQkxFKSB7XG4gICAgICAgIGlzVmVydGljYWxNb3ZlbWVudCA9IHRydWU7XG4gICAgICB9XG4gICAgICBjb25zdCByYXRpb01vZGUgPSBpc1ZlcnRpY2FsTW92ZW1lbnQgPyAnd2lkdGgnIDogJ2hlaWdodCc7XG4gICAgICBib3guY29uc3RyYWluVG9SYXRpbyhyYXRpbywgb3JpZ2luLCByYXRpb01vZGUpO1xuICAgIH1cblxuICAgIC8vIE1haW50YWluIG1pbmltdW0vbWF4aW11bSBzaXplXG4gICAgY29uc3QgbWluID0gdGhpcy5vcHRpb25zLm1pblNpemU7XG4gICAgY29uc3QgbWF4ID0gdGhpcy5vcHRpb25zLm1heFNpemU7XG4gICAgYm94LmNvbnN0cmFpblRvU2l6ZShtYXgud2lkdGgsIG1heC5oZWlnaHQsIG1pbi53aWR0aCwgbWluLmhlaWdodCwgb3JpZ2luLCB0aGlzLm9wdGlvbnMuYXNwZWN0UmF0aW8pO1xuXG4gICAgLy8gQ29uc3RyYWluIHRvIGJvdW5kYXJ5XG4gICAgY29uc3QgcGFyZW50V2lkdGggPSB0aGlzLmNyb3BwZXJFbC5vZmZzZXRXaWR0aDtcbiAgICBjb25zdCBwYXJlbnRIZWlnaHQgPSB0aGlzLmNyb3BwZXJFbC5vZmZzZXRIZWlnaHQ7XG4gICAgYm94LmNvbnN0cmFpblRvQm91bmRhcnkocGFyZW50V2lkdGgsIHBhcmVudEhlaWdodCwgb3JpZ2luKTtcblxuICAgIC8vIEZpbmFsbHksIHVwZGF0ZSB0aGUgdmlzdWFscyAoYm9yZGVyLCBoYW5kbGVzLCBjbGlwcGVkIGltYWdlLCBldGMpXG4gICAgdGhpcy5ib3ggPSBib3g7XG4gICAgdGhpcy5yZWRyYXcoKTtcblxuICAgIC8vIFRyaWdnZXIgY2FsbGJhY2tcbiAgICBpZiAodGhpcy5vcHRpb25zLm9uQ3JvcE1vdmUgIT09IG51bGwpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5vbkNyb3BNb3ZlKHRoaXMuZ2V0VmFsdWUoKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVWRU5UIEhBTkRMRVJcbiAgICogRXhlY3V0ZXMgb24gaGFuZGxlIG1vdmUgZW5kLlxuICAgKi9cbiAgb25IYW5kbGVNb3ZlRW5kKGU6IGFueSkge1xuICAgIC8vIFRyaWdnZXIgY2FsbGJhY2tcbiAgICBpZiAodGhpcy5vcHRpb25zLm9uQ3JvcEVuZCAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5vcHRpb25zLm9uQ3JvcEVuZCh0aGlzLmdldFZhbHVlKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFVkVOVCBIQU5ETEVSXG4gICAqIEV4ZWN1dGVzIHdoZW4gdXNlciBzdGFydHMgbW92aW5nIHRoZSBjcm9wIHJlZ2lvbi5cbiAgICovXG4gIG9uUmVnaW9uTW92ZVN0YXJ0KGU6IGFueSkge1xuICAgIGxldCB7IG1vdXNlWCwgbW91c2VZIH0gPSBlLmRldGFpbDtcblxuICAgIC8vIENhbGN1bGF0ZSBtb3VzZSdzIHBvc2l0aW9uIGluIHJlbGF0aXZlIHRvIHRoZSBjb250YWluZXJcbiAgICBsZXQgY29udGFpbmVyID0gdGhpcy5jcm9wcGVyRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbW91c2VYID0gbW91c2VYIC0gY29udGFpbmVyLmxlZnQ7XG4gICAgbW91c2VZID0gbW91c2VZIC0gY29udGFpbmVyLnRvcDtcblxuICAgIHRoaXMuY3VycmVudE1vdmUgPSB7XG4gICAgICBvZmZzZXRYOiBtb3VzZVggLSB0aGlzLmJveC54MSxcbiAgICAgIG9mZnNldFk6IG1vdXNlWSAtIHRoaXMuYm94LnkxLFxuICAgIH07XG5cbiAgICAvLyBUcmlnZ2VyIGNhbGxiYWNrXG4gICAgaWYgKHRoaXMub3B0aW9ucy5vbkNyb3BTdGFydCAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5vcHRpb25zLm9uQ3JvcFN0YXJ0KHRoaXMuZ2V0VmFsdWUoKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVWRU5UIEhBTkRMRVJcbiAgICogRXhlY3V0ZXMgd2hlbiB1c2VyIG1vdmVzIHRoZSBjcm9wIHJlZ2lvbi5cbiAgICovXG4gIG9uUmVnaW9uTW92ZU1vdmluZyhlOiBhbnkpIHtcbiAgICBsZXQgeyBtb3VzZVgsIG1vdXNlWSB9ID0gZS5kZXRhaWw7XG4gICAgbGV0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gdGhpcy5jdXJyZW50TW92ZTtcblxuICAgIC8vIENhbGN1bGF0ZSBtb3VzZSdzIHBvc2l0aW9uIGluIHJlbGF0aXZlIHRvIHRoZSBjb250YWluZXJcbiAgICBsZXQgY29udGFpbmVyID0gdGhpcy5jcm9wcGVyRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbW91c2VYID0gbW91c2VYIC0gY29udGFpbmVyLmxlZnQ7XG4gICAgbW91c2VZID0gbW91c2VZIC0gY29udGFpbmVyLnRvcDtcblxuICAgIHRoaXMuYm94Lm1vdmUobW91c2VYIC0gb2Zmc2V0WCwgbW91c2VZIC0gb2Zmc2V0WSk7XG5cbiAgICAvLyBFbnN1cmUgYm94IGlzIHdpdGhpbiB0aGUgYm91bmRhcmllc1xuICAgIGlmICh0aGlzLmJveC54MSA8IDApIHtcbiAgICAgIHRoaXMuYm94Lm1vdmUoMCwgbnVsbCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmJveC54MiA+IGNvbnRhaW5lci53aWR0aCkge1xuICAgICAgdGhpcy5ib3gubW92ZShjb250YWluZXIud2lkdGggLSB0aGlzLmJveC53aWR0aCgpLCBudWxsKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuYm94LnkxIDwgMCkge1xuICAgICAgdGhpcy5ib3gubW92ZShudWxsLCAwKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuYm94LnkyID4gY29udGFpbmVyLmhlaWdodCkge1xuICAgICAgdGhpcy5ib3gubW92ZShudWxsLCBjb250YWluZXIuaGVpZ2h0IC0gdGhpcy5ib3guaGVpZ2h0KCkpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB2aXN1YWxzXG4gICAgdGhpcy5yZWRyYXcoKTtcblxuICAgIC8vIFRyaWdnZXIgY2FsbGJhY2tcbiAgICBpZiAodGhpcy5vcHRpb25zLm9uQ3JvcE1vdmUgIT09IG51bGwpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5vbkNyb3BNb3ZlKHRoaXMuZ2V0VmFsdWUoKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVWRU5UIEhBTkRMRVJcbiAgICogRXhlY3V0ZXMgd2hlbiB1c2VyIHN0b3BzIG1vdmluZyB0aGUgY3JvcCByZWdpb24gKG1vdXNlIHVwKS5cbiAgICovXG4gIG9uUmVnaW9uTW92ZUVuZChlOiBhbnkpIHtcbiAgICAvLyBUcmlnZ2VyIGNhbGxiYWNrXG4gICAgaWYgKHRoaXMub3B0aW9ucy5vbkNyb3BFbmQgIT09IG51bGwpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5vbkNyb3BFbmQodGhpcy5nZXRWYWx1ZSgpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRoZSB2YWx1ZSBvZiB0aGUgY3JvcCByZWdpb24uXG4gICAqL1xuICBnZXRWYWx1ZShtb2RlID0gbnVsbCkge1xuICAgIGlmIChtb2RlID09PSBudWxsKSB7XG4gICAgICBtb2RlID0gdGhpcy5vcHRpb25zLnJldHVybk1vZGU7XG4gICAgfVxuICAgIGlmIChtb2RlID09ICdyZWFsJykge1xuICAgICAgY29uc3QgYWN0dWFsV2lkdGggPSB0aGlzLmltYWdlRWwubmF0dXJhbFdpZHRoO1xuICAgICAgY29uc3QgYWN0dWFsSGVpZ2h0ID0gdGhpcy5pbWFnZUVsLm5hdHVyYWxIZWlnaHQ7XG4gICAgICBjb25zdCB7IHdpZHRoOiBlbGVtZW50V2lkdGgsIGhlaWdodDogZWxlbWVudEhlaWdodCB9ID0gdGhpcy5pbWFnZUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgZmFjdG9yWCA9IGFjdHVhbFdpZHRoIC8gZWxlbWVudFdpZHRoO1xuICAgICAgY29uc3QgZmFjdG9yWSA9IGFjdHVhbEhlaWdodCAvIGVsZW1lbnRIZWlnaHQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiBNYXRoLnJvdW5kKHRoaXMuYm94LngxICogZmFjdG9yWCksXG4gICAgICAgIHk6IE1hdGgucm91bmQodGhpcy5ib3gueTEgKiBmYWN0b3JZKSxcbiAgICAgICAgd2lkdGg6IE1hdGgucm91bmQodGhpcy5ib3gud2lkdGgoKSAqIGZhY3RvclgpLFxuICAgICAgICBoZWlnaHQ6IE1hdGgucm91bmQodGhpcy5ib3guaGVpZ2h0KCkgKiBmYWN0b3JZKSxcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChtb2RlID09ICdyYXRpbycpIHtcbiAgICAgIGNvbnN0IHsgd2lkdGg6IGVsZW1lbnRXaWR0aCwgaGVpZ2h0OiBlbGVtZW50SGVpZ2h0IH0gPSB0aGlzLmltYWdlRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiByb3VuZCh0aGlzLmJveC54MSAvIGVsZW1lbnRXaWR0aCwgMyksXG4gICAgICAgIHk6IHJvdW5kKHRoaXMuYm94LnkxIC8gZWxlbWVudEhlaWdodCwgMyksXG4gICAgICAgIHdpZHRoOiByb3VuZCh0aGlzLmJveC53aWR0aCgpIC8gZWxlbWVudFdpZHRoLCAzKSxcbiAgICAgICAgaGVpZ2h0OiByb3VuZCh0aGlzLmJveC5oZWlnaHQoKSAvIGVsZW1lbnRIZWlnaHQsIDMpLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKG1vZGUgPT0gJ3JhdycpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IE1hdGgucm91bmQodGhpcy5ib3gueDEpLFxuICAgICAgICB5OiBNYXRoLnJvdW5kKHRoaXMuYm94LnkxKSxcbiAgICAgICAgd2lkdGg6IE1hdGgucm91bmQodGhpcy5ib3gud2lkdGgoKSksXG4gICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCh0aGlzLmJveC5oZWlnaHQoKSksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSB1c2VyIG9wdGlvbnMgYW5kIHNldCBkZWZhdWx0IHZhbHVlcy5cbiAgICovXG4gIHN0YXRpYyBwYXJzZU9wdGlvbnMob3B0czogYW55KSB7XG4gICAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgICBhc3BlY3RSYXRpbzogbnVsbCxcbiAgICAgIG1heFNpemU6IHsgd2lkdGg6IG51bGwsIGhlaWdodDogbnVsbCB9LFxuICAgICAgbWluU2l6ZTogeyB3aWR0aDogbnVsbCwgaGVpZ2h0OiBudWxsIH0sXG4gICAgICBzdGFydFNpemU6IHsgd2lkdGg6IDEwMCwgaGVpZ2h0OiAxMDAsIHVuaXQ6ICclJyB9LFxuICAgICAgcmV0dXJuTW9kZTogJ3JlYWwnLFxuICAgICAgb25Jbml0aWFsaXplOiBudWxsLFxuICAgICAgb25Dcm9wU3RhcnQ6IG51bGwsXG4gICAgICBvbkNyb3BNb3ZlOiBudWxsLFxuICAgICAgb25Dcm9wRW5kOiBudWxsLFxuICAgIH07XG5cbiAgICAvLyBQYXJzZSBhc3BlY3QgcmF0aW9cbiAgICBsZXQgYXNwZWN0UmF0aW8gPSBudWxsO1xuICAgIGlmIChvcHRzLmFzcGVjdFJhdGlvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICh0eXBlb2Ygb3B0cy5hc3BlY3RSYXRpbyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgYXNwZWN0UmF0aW8gPSBvcHRzLmFzcGVjdFJhdGlvO1xuICAgICAgfSBlbHNlIGlmIChvcHRzLmFzcGVjdFJhdGlvIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgYXNwZWN0UmF0aW8gPSBvcHRzLmFzcGVjdFJhdGlvWzFdIC8gb3B0cy5hc3BlY3RSYXRpb1swXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBQYXJzZSBtYXggd2lkdGgvaGVpZ2h0XG4gICAgbGV0IG1heFNpemUgPSBudWxsO1xuICAgIGlmIChvcHRzLm1heFNpemUgIT09IHVuZGVmaW5lZCAmJiBvcHRzLm1heFNpemUgIT09IG51bGwpIHtcbiAgICAgIG1heFNpemUgPSB7XG4gICAgICAgIHdpZHRoOiBvcHRzLm1heFNpemVbMF0gfHwgbnVsbCxcbiAgICAgICAgaGVpZ2h0OiBvcHRzLm1heFNpemVbMV0gfHwgbnVsbCxcbiAgICAgICAgdW5pdDogb3B0cy5tYXhTaXplWzJdIHx8ICdweCcsXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFBhcnNlIG1pbiB3aWR0aC9oZWlnaHRcbiAgICBsZXQgbWluU2l6ZSA9IG51bGw7XG4gICAgaWYgKG9wdHMubWluU2l6ZSAhPT0gdW5kZWZpbmVkICYmIG9wdHMubWluU2l6ZSAhPT0gbnVsbCkge1xuICAgICAgbWluU2l6ZSA9IHtcbiAgICAgICAgd2lkdGg6IG9wdHMubWluU2l6ZVswXSB8fCBudWxsLFxuICAgICAgICBoZWlnaHQ6IG9wdHMubWluU2l6ZVsxXSB8fCBudWxsLFxuICAgICAgICB1bml0OiBvcHRzLm1pblNpemVbMl0gfHwgJ3B4JyxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUGFyc2Ugc3RhcnQgc2l6ZVxuICAgIGxldCBzdGFydFNpemUgPSBudWxsO1xuICAgIGlmIChvcHRzLnN0YXJ0U2l6ZSAhPT0gdW5kZWZpbmVkICYmIG9wdHMuc3RhcnRTaXplICE9PSBudWxsKSB7XG4gICAgICBzdGFydFNpemUgPSB7XG4gICAgICAgIHdpZHRoOiBvcHRzLnN0YXJ0U2l6ZVswXSB8fCBudWxsLFxuICAgICAgICBoZWlnaHQ6IG9wdHMuc3RhcnRTaXplWzFdIHx8IG51bGwsXG4gICAgICAgIHVuaXQ6IG9wdHMuc3RhcnRTaXplWzJdIHx8ICclJyxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgY2FsbGJhY2tzXG4gICAgbGV0IG9uSW5pdGlhbGl6ZSA9IG51bGw7XG4gICAgaWYgKHR5cGVvZiBvcHRzLm9uSW5pdGlhbGl6ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgb25Jbml0aWFsaXplID0gb3B0cy5vbkluaXRpYWxpemU7XG4gICAgfVxuXG4gICAgbGV0IG9uQ3JvcFN0YXJ0ID0gbnVsbDtcbiAgICBpZiAodHlwZW9mIG9wdHMub25Dcm9wU3RhcnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIG9uQ3JvcFN0YXJ0ID0gb3B0cy5vbkNyb3BTdGFydDtcbiAgICB9XG5cbiAgICBsZXQgb25Dcm9wRW5kID0gbnVsbDtcbiAgICBpZiAodHlwZW9mIG9wdHMub25Dcm9wRW5kID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBvbkNyb3BFbmQgPSBvcHRzLm9uQ3JvcEVuZDtcbiAgICB9XG5cbiAgICBsZXQgb25Dcm9wTW92ZSA9IG51bGw7XG4gICAgaWYgKHR5cGVvZiBvcHRzLm9uVXBkYXRlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAvLyBERVBSRUNBVEVEOiBvblVwZGF0ZSBpcyBkZXByZWNhdGVkIHRvIGNyZWF0ZSBhIG1vcmUgdW5pZm9ybVxuICAgICAgLy8gY2FsbGJhY2sgQVBJLCBzdWNoIGFzOiBvbkNyb3BTdGFydCwgb25Dcm9wTW92ZSwgb25Dcm9wRW5kXG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdDcm9wcHIuanM6IGBvblVwZGF0ZWAgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHJlbGVhc2UuIFBsZWFzZSB1c2UgYG9uQ3JvcE1vdmVgIG9yIGBvbkNyb3BFbmRgIGluc3RlYWQuJyxcbiAgICAgICk7XG4gICAgICBvbkNyb3BNb3ZlID0gb3B0cy5vblVwZGF0ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvcHRzLm9uQ3JvcE1vdmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIG9uQ3JvcE1vdmUgPSBvcHRzLm9uQ3JvcE1vdmU7XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgcmV0dXJuTW9kZSB2YWx1ZVxuICAgIGxldCByZXR1cm5Nb2RlID0gbnVsbDtcbiAgICBpZiAob3B0cy5yZXR1cm5Nb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IHMgPSBvcHRzLnJldHVybk1vZGUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChbJ3JlYWwnLCAncmF0aW8nLCAncmF3J10uaW5kZXhPZihzKSA9PT0gLTEpIHtcbiAgICAgICAgdGhyb3cgJ0ludmFsaWQgcmV0dXJuIG1vZGUuJztcbiAgICAgIH1cbiAgICAgIHJldHVybk1vZGUgPSBzO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBmdW5jdGlvbiB0byBjb252ZXJ0ICUgdmFsdWVzIHRvIHBpeGVsc1xuICAgIGNvbnN0IGNvbnZlcnRUb1BpeGVscyA9IGZ1bmN0aW9uICh0aGlzOiBhbnksIGNvbnRhaW5lcjogYW55KSB7XG4gICAgICBjb25zdCB3aWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgICAgIGNvbnN0IGhlaWdodCA9IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgIC8vIENvbnZlcnQgc2l6ZXNcbiAgICAgIGNvbnN0IHNpemVLZXlzID0gWydtYXhTaXplJywgJ21pblNpemUnLCAnc3RhcnRTaXplJ107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemVLZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IHNpemVLZXlzW2ldO1xuICAgICAgICBpZiAodGhpc1trZXldICE9PSBudWxsKSB7XG4gICAgICAgICAgaWYgKHRoaXNba2V5XS51bml0ID09ICclJykge1xuICAgICAgICAgICAgaWYgKHRoaXNba2V5XS53aWR0aCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICB0aGlzW2tleV0ud2lkdGggPSAodGhpc1trZXldLndpZHRoIC8gMTAwKSAqIHdpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXNba2V5XS5oZWlnaHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdGhpc1trZXldLmhlaWdodCA9ICh0aGlzW2tleV0uaGVpZ2h0IC8gMTAwKSAqIGhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZGVsZXRlIHRoaXNba2V5XS51bml0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9ICh2OiBhbnksIGQ6IGFueSkgPT4gKHYgIT09IG51bGwgPyB2IDogZCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFzcGVjdFJhdGlvOiBkZWZhdWx0VmFsdWUoYXNwZWN0UmF0aW8sIGRlZmF1bHRzLmFzcGVjdFJhdGlvKSxcbiAgICAgIG1heFNpemU6IGRlZmF1bHRWYWx1ZShtYXhTaXplLCBkZWZhdWx0cy5tYXhTaXplKSxcbiAgICAgIG1pblNpemU6IGRlZmF1bHRWYWx1ZShtaW5TaXplLCBkZWZhdWx0cy5taW5TaXplKSxcbiAgICAgIHN0YXJ0U2l6ZTogZGVmYXVsdFZhbHVlKHN0YXJ0U2l6ZSwgZGVmYXVsdHMuc3RhcnRTaXplKSxcbiAgICAgIHJldHVybk1vZGU6IGRlZmF1bHRWYWx1ZShyZXR1cm5Nb2RlLCBkZWZhdWx0cy5yZXR1cm5Nb2RlKSxcbiAgICAgIG9uSW5pdGlhbGl6ZTogZGVmYXVsdFZhbHVlKG9uSW5pdGlhbGl6ZSwgZGVmYXVsdHMub25Jbml0aWFsaXplKSxcbiAgICAgIG9uQ3JvcFN0YXJ0OiBkZWZhdWx0VmFsdWUob25Dcm9wU3RhcnQsIGRlZmF1bHRzLm9uQ3JvcFN0YXJ0KSxcbiAgICAgIG9uQ3JvcE1vdmU6IGRlZmF1bHRWYWx1ZShvbkNyb3BNb3ZlLCBkZWZhdWx0cy5vbkNyb3BNb3ZlKSxcbiAgICAgIG9uQ3JvcEVuZDogZGVmYXVsdFZhbHVlKG9uQ3JvcEVuZCwgZGVmYXVsdHMub25Dcm9wRW5kKSxcbiAgICAgIGNvbnZlcnRUb1BpeGVsczogY29udmVydFRvUGl4ZWxzLFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBIRUxQRVIgRlVOQ1RJT05TXG4gKi9cblxuZnVuY3Rpb24gcm91bmQodmFsdWU6IGFueSwgZGVjaW1hbHM6IGFueSkge1xuICByZXR1cm4gTnVtYmVyKE1hdGgucm91bmQoKHZhbHVlICsgJ2UnICsgZGVjaW1hbHMpIGFzIGFueSkgKyAnZS0nICsgZGVjaW1hbHMpO1xufVxuIl19