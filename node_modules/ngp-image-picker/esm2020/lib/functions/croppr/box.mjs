/**
 * Box component
 */
export default class Box {
    constructor(x1, y1, x2, y2) {
        this.x1 = x1;
        this.y1 = y1;
        this.x2 = x2;
        this.y2 = y2;
    }
    /**
     * Sets the new dimensions of the box.
     * @param {Number} x1
     * @param {Number} y1
     * @param {Number} x2
     * @param {Number} y2
     */
    set(x1 = null, y1 = null, x2 = null, y2 = null) {
        this.x1 = x1 == null ? this.x1 : x1;
        this.y1 = y1 == null ? this.y1 : y1;
        this.x2 = x2 == null ? this.x2 : x2;
        this.y2 = y2 == null ? this.y2 : y2;
        return this;
    }
    /**
     * Calculates the width of the box.
     * @returns {Number}
     */
    width() {
        return Math.abs(this.x2 - this.x1);
    }
    /**
     * Calculates the height of the box.
     * @returns {Number}
     */
    height() {
        return Math.abs(this.y2 - this.y1);
    }
    /**
     * Resizes the box to a new size.
     * @param {Number} newWidth
     * @param {Number} newHeight
     * @param {Array} [origin] The origin point to resize from.
     *      Defaults to [0, 0] (top left).
     */
    resize(newWidth, newHeight, origin = [0, 0]) {
        const fromX = this.x1 + this.width() * origin[0];
        const fromY = this.y1 + this.height() * origin[1];
        this.x1 = fromX - newWidth * origin[0];
        this.y1 = fromY - newHeight * origin[1];
        this.x2 = this.x1 + newWidth;
        this.y2 = this.y1 + newHeight;
        return this;
    }
    /**
     * Scale the box by a factor.
     * @param {Number} factor
     * @param {Array} [origin] The origin point to resize from.
     *      Defaults to [0, 0] (top left).
     */
    scale(factor, origin = [0, 0]) {
        const newWidth = this.width() * factor;
        const newHeight = this.height() * factor;
        this.resize(newWidth, newHeight, origin);
        return this;
    }
    /**
     * Move the box to the specified coordinates.
     */
    move(x = null, y = null) {
        let width = this.width();
        let height = this.height();
        x = x === null ? this.x1 : x;
        y = y === null ? this.y1 : y;
        this.x1 = x;
        this.y1 = y;
        this.x2 = x + width;
        this.y2 = y + height;
        return this;
    }
    /**
     * Get relative x and y coordinates of a given point within the box.
     * @param {Array} point The x and y ratio position within the box.
     * @returns {Array} The x and y coordinates [x, y].
     */
    getRelativePoint(point = [0, 0]) {
        const x = this.width() * point[0];
        const y = this.height() * point[1];
        return [x, y];
    }
    /**
     * Get absolute x and y coordinates of a given point within the box.
     * @param {Array} point The x and y ratio position within the box.
     * @returns {Array} The x and y coordinates [x, y].
     */
    getAbsolutePoint(point = [0, 0]) {
        const x = this.x1 + this.width() * point[0];
        const y = this.y1 + this.height() * point[1];
        return [x, y];
    }
    /**
     * Constrain the box to a fixed ratio.
     * @param {Number} ratio
     * @param {Array} [origin] The origin point to resize from.
     *     Defaults to [0, 0] (top left).
     * @param {String} [grow] The axis to grow to maintain the ratio.
     *     Defaults to 'height'.
     */
    constrainToRatio(ratio, origin = [0, 0], grow = "height") {
        if (ratio === null) {
            return;
        }
        const width = this.width();
        const height = this.height();
        switch (grow) {
            case "height": // Grow height only
                this.resize(this.width(), this.width() * ratio, origin);
                break;
            case "width": // Grow width only
                this.resize((this.height() * 1) / ratio, this.height(), origin);
                break;
            default: // Default: Grow height only
                this.resize(this.width(), this.width() * ratio, origin);
        }
        return this;
    }
    /**
     * Constrain the box within a boundary.
     * @param {Number} boundaryWidth
     * @param {Number} boundaryHeight
     * @param {Array} [origin] The origin point to resize from.
     *     Defaults to [0, 0] (top left).
     */
    constrainToBoundary(boundaryWidth, boundaryHeight, origin = [0, 0]) {
        // Calculate the maximum sizes for each direction of growth
        const [originX, originY] = this.getAbsolutePoint(origin);
        const maxIfLeft = originX;
        const maxIfTop = originY;
        const maxIfRight = boundaryWidth - originX;
        const maxIfBottom = boundaryHeight - originY;
        // Express the direction of growth in terms of left, both,
        // and right as -1, 0, and 1 respectively. Ditto for top/both/down.
        const directionX = -2 * origin[0] + 1;
        const directionY = -2 * origin[1] + 1;
        // Determine the max size to use according to the direction of growth.
        let [maxWidth, maxHeight] = [null, null];
        switch (directionX) {
            case -1:
                maxWidth = maxIfLeft;
                break;
            case 0:
                maxWidth = (Math.min(maxIfLeft, maxIfRight) * 2);
                break;
            case +1:
                maxWidth = maxIfRight;
                break;
        }
        switch (directionY) {
            case -1:
                maxHeight = maxIfTop;
                break;
            case 0:
                maxHeight = (Math.min(maxIfTop, maxIfBottom) * 2);
                break;
            case +1:
                maxHeight = maxIfBottom;
                break;
        }
        // Resize if the box exceeds the calculated max width/height.
        if (this.width() > maxWidth) {
            const factor = maxWidth / this.width();
            this.scale(factor, origin);
        }
        if (this.height() > maxHeight) {
            const factor = maxHeight / this.height();
            this.scale(factor, origin);
        }
        return this;
    }
    /**
     * Constrain the box to a maximum/minimum size.
     * @param {Number} [maxWidth]
     * @param {Number} [maxHeight]
     * @param {Number} [minWidth]
     * @param {Number} [minHeight]
     * @param {Array} [origin] The origin point to resize from.
     *     Defaults to [0, 0] (top left).
     * @param {Number} [ratio] Ratio to maintain.
     */
    constrainToSize(maxWidth = null, maxHeight = null, minWidth = null, minHeight = null, origin = [0, 0], ratio = null) {
        // Calculate new max/min widths & heights that constrains to the ratio
        if (ratio) {
            if (ratio > 1) {
                maxWidth = (maxHeight * 1) / ratio;
                minHeight = minHeight * ratio;
            }
            else if (ratio < 1) {
                maxHeight = maxWidth * ratio;
                minWidth = (minHeight * 1) / ratio;
            }
        }
        if (maxWidth && this.width() > maxWidth) {
            const newWidth = maxWidth, newHeight = ratio === null ? this.height() : maxHeight;
            this.resize(newWidth, newHeight, origin);
        }
        if (maxHeight && this.height() > maxHeight) {
            const newWidth = ratio === null ? this.width() : maxWidth, newHeight = maxHeight;
            this.resize(newWidth, newHeight, origin);
        }
        if (minWidth && this.width() < minWidth) {
            const newWidth = minWidth, newHeight = ratio === null ? this.height() : minHeight;
            this.resize(newWidth, newHeight, origin);
        }
        if (minHeight && this.height() < minHeight) {
            const newWidth = ratio === null ? this.width() : minWidth, newHeight = minHeight;
            this.resize(newWidth, newHeight, origin);
        }
        return this;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm94LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmdwLWltYWdlLXBpY2tlci9zcmMvbGliL2Z1bmN0aW9ucy9jcm9wcHIvYm94LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE9BQU8sT0FBTyxHQUFHO0lBY3RCLFlBQVksRUFBTyxFQUFFLEVBQU8sRUFBRSxFQUFPLEVBQUUsRUFBTztRQUM1QyxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztJQUNmLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxHQUFHLENBQUMsRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxHQUFHLElBQUk7UUFDNUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDcEMsT0FBTyxJQUFJ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QUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUMxQztRQUVELElBQUksU0FBUyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxTQUFTLEVBQUU7WUFDMUMsTUFBTSxRQUFRLEdBQUcsS0FBSyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQ3ZELFNBQVMsR0FBRyxTQUFTLENBQUM7WUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQzFDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJveCBjb21wb25lbnRcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm94IHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgQm94IGluc3RhbmNlLlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHgxXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB5MVxuICAgKiBAcGFyYW0ge051bWJlcn0geDJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHkyXG4gICAqL1xuICB4MTogYW55O1xuICB5MTogYW55O1xuICB4MjogYW55O1xuICB5MjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHgxOiBhbnksIHkxOiBhbnksIHgyOiBhbnksIHkyOiBhbnkpIHtcbiAgICB0aGlzLngxID0geDE7XG4gICAgdGhpcy55MSA9IHkxO1xuICAgIHRoaXMueDIgPSB4MjtcbiAgICB0aGlzLnkyID0geTI7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgbmV3IGRpbWVuc2lvbnMgb2YgdGhlIGJveC5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IHgxXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB5MVxuICAgKiBAcGFyYW0ge051bWJlcn0geDJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHkyXG4gICAqL1xuICBzZXQoeDEgPSBudWxsLCB5MSA9IG51bGwsIHgyID0gbnVsbCwgeTIgPSBudWxsKSB7XG4gICAgdGhpcy54MSA9IHgxID09IG51bGwgPyB0aGlzLngxIDogeDE7XG4gICAgdGhpcy55MSA9IHkxID09IG51bGwgPyB0aGlzLnkxIDogeTE7XG4gICAgdGhpcy54MiA9IHgyID09IG51bGwgPyB0aGlzLngyIDogeDI7XG4gICAgdGhpcy55MiA9IHkyID09IG51bGwgPyB0aGlzLnkyIDogeTI7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyB0aGUgd2lkdGggb2YgdGhlIGJveC5cbiAgICogQHJldHVybnMge051bWJlcn1cbiAgICovXG4gIHdpZHRoKCkge1xuICAgIHJldHVybiBNYXRoLmFicyh0aGlzLngyIC0gdGhpcy54MSk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyB0aGUgaGVpZ2h0IG9mIHRoZSBib3guXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAqL1xuICBoZWlnaHQoKSB7XG4gICAgcmV0dXJuIE1hdGguYWJzKHRoaXMueTIgLSB0aGlzLnkxKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNpemVzIHRoZSBib3ggdG8gYSBuZXcgc2l6ZS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IG5ld1dpZHRoXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBuZXdIZWlnaHRcbiAgICogQHBhcmFtIHtBcnJheX0gW29yaWdpbl0gVGhlIG9yaWdpbiBwb2ludCB0byByZXNpemUgZnJvbS5cbiAgICogICAgICBEZWZhdWx0cyB0byBbMCwgMF0gKHRvcCBsZWZ0KS5cbiAgICovXG4gIHJlc2l6ZShuZXdXaWR0aDogYW55LCBuZXdIZWlnaHQ6IGFueSwgb3JpZ2luID0gWzAsIDBdKSB7XG4gICAgY29uc3QgZnJvbVggPSB0aGlzLngxICsgdGhpcy53aWR0aCgpICogb3JpZ2luWzBdO1xuICAgIGNvbnN0IGZyb21ZID0gdGhpcy55MSArIHRoaXMuaGVpZ2h0KCkgKiBvcmlnaW5bMV07XG5cblxuICAgIHRoaXMueDEgPSBmcm9tWCAtIG5ld1dpZHRoICogb3JpZ2luWzBdO1xuICAgIHRoaXMueTEgPSBmcm9tWSAtIG5ld0hlaWdodCAqIG9yaWdpblsxXTtcbiAgICB0aGlzLngyID0gdGhpcy54MSArIG5ld1dpZHRoO1xuICAgIHRoaXMueTIgPSB0aGlzLnkxICsgbmV3SGVpZ2h0O1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2NhbGUgdGhlIGJveCBieSBhIGZhY3Rvci5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGZhY3RvclxuICAgKiBAcGFyYW0ge0FycmF5fSBbb3JpZ2luXSBUaGUgb3JpZ2luIHBvaW50IHRvIHJlc2l6ZSBmcm9tLlxuICAgKiAgICAgIERlZmF1bHRzIHRvIFswLCAwXSAodG9wIGxlZnQpLlxuICAgKi9cbiAgc2NhbGUoZmFjdG9yOiBhbnksIG9yaWdpbiA9IFswLCAwXSkge1xuICAgIGNvbnN0IG5ld1dpZHRoID0gdGhpcy53aWR0aCgpICogZmFjdG9yO1xuICAgIGNvbnN0IG5ld0hlaWdodCA9IHRoaXMuaGVpZ2h0KCkgKiBmYWN0b3I7XG4gICAgdGhpcy5yZXNpemUobmV3V2lkdGgsIG5ld0hlaWdodCwgb3JpZ2luKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoZSBib3ggdG8gdGhlIHNwZWNpZmllZCBjb29yZGluYXRlcy5cbiAgICovXG4gIG1vdmUoeCA9IG51bGwsIHkgPSBudWxsKSB7XG4gICAgbGV0IHdpZHRoID0gdGhpcy53aWR0aCgpO1xuICAgIGxldCBoZWlnaHQgPSB0aGlzLmhlaWdodCgpO1xuICAgIHggPSB4ID09PSBudWxsID8gdGhpcy54MSA6IHg7XG4gICAgeSA9IHkgPT09IG51bGwgPyB0aGlzLnkxIDogeTtcblxuICAgIHRoaXMueDEgPSB4O1xuICAgIHRoaXMueTEgPSB5O1xuICAgIHRoaXMueDIgPSAoeCBhcyBhbnkpICsgd2lkdGg7XG4gICAgdGhpcy55MiA9ICh5IGFzIGFueSkgKyBoZWlnaHQ7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHJlbGF0aXZlIHggYW5kIHkgY29vcmRpbmF0ZXMgb2YgYSBnaXZlbiBwb2ludCB3aXRoaW4gdGhlIGJveC5cbiAgICogQHBhcmFtIHtBcnJheX0gcG9pbnQgVGhlIHggYW5kIHkgcmF0aW8gcG9zaXRpb24gd2l0aGluIHRoZSBib3guXG4gICAqIEByZXR1cm5zIHtBcnJheX0gVGhlIHggYW5kIHkgY29vcmRpbmF0ZXMgW3gsIHldLlxuICAgKi9cbiAgZ2V0UmVsYXRpdmVQb2ludChwb2ludCA9IFswLCAwXSkge1xuICAgIGNvbnN0IHggPSB0aGlzLndpZHRoKCkgKiBwb2ludFswXTtcbiAgICBjb25zdCB5ID0gdGhpcy5oZWlnaHQoKSAqIHBvaW50WzFdO1xuICAgIHJldHVybiBbeCwgeV07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFic29sdXRlIHggYW5kIHkgY29vcmRpbmF0ZXMgb2YgYSBnaXZlbiBwb2ludCB3aXRoaW4gdGhlIGJveC5cbiAgICogQHBhcmFtIHtBcnJheX0gcG9pbnQgVGhlIHggYW5kIHkgcmF0aW8gcG9zaXRpb24gd2l0aGluIHRoZSBib3guXG4gICAqIEByZXR1cm5zIHtBcnJheX0gVGhlIHggYW5kIHkgY29vcmRpbmF0ZXMgW3gsIHldLlxuICAgKi9cbiAgZ2V0QWJzb2x1dGVQb2ludChwb2ludCA9IFswLCAwXSkge1xuICAgIGNvbnN0IHggPSB0aGlzLngxICsgdGhpcy53aWR0aCgpICogcG9pbnRbMF07XG4gICAgY29uc3QgeSA9IHRoaXMueTEgKyB0aGlzLmhlaWdodCgpICogcG9pbnRbMV07XG4gICAgcmV0dXJuIFt4LCB5XTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJhaW4gdGhlIGJveCB0byBhIGZpeGVkIHJhdGlvLlxuICAgKiBAcGFyYW0ge051bWJlcn0gcmF0aW9cbiAgICogQHBhcmFtIHtBcnJheX0gW29yaWdpbl0gVGhlIG9yaWdpbiBwb2ludCB0byByZXNpemUgZnJvbS5cbiAgICogICAgIERlZmF1bHRzIHRvIFswLCAwXSAodG9wIGxlZnQpLlxuICAgKiBAcGFyYW0ge1N0cmluZ30gW2dyb3ddIFRoZSBheGlzIHRvIGdyb3cgdG8gbWFpbnRhaW4gdGhlIHJhdGlvLlxuICAgKiAgICAgRGVmYXVsdHMgdG8gJ2hlaWdodCcuXG4gICAqL1xuICBjb25zdHJhaW5Ub1JhdGlvKHJhdGlvOiBhbnksIG9yaWdpbiA9IFswLCAwXSwgZ3JvdyA9IFwiaGVpZ2h0XCIpIHtcbiAgICBpZiAocmF0aW8gPT09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoKCk7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQoKTtcbiAgICBzd2l0Y2ggKGdyb3cpIHtcbiAgICAgIGNhc2UgXCJoZWlnaHRcIjogLy8gR3JvdyBoZWlnaHQgb25seVxuICAgICAgICB0aGlzLnJlc2l6ZSh0aGlzLndpZHRoKCksIHRoaXMud2lkdGgoKSAqIHJhdGlvLCBvcmlnaW4pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ3aWR0aFwiOiAvLyBHcm93IHdpZHRoIG9ubHlcbiAgICAgICAgdGhpcy5yZXNpemUoKHRoaXMuaGVpZ2h0KCkgKiAxKSAvIHJhdGlvLCB0aGlzLmhlaWdodCgpLCBvcmlnaW4pO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6IC8vIERlZmF1bHQ6IEdyb3cgaGVpZ2h0IG9ubHlcbiAgICAgICAgdGhpcy5yZXNpemUodGhpcy53aWR0aCgpLCB0aGlzLndpZHRoKCkgKiByYXRpbywgb3JpZ2luKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJhaW4gdGhlIGJveCB3aXRoaW4gYSBib3VuZGFyeS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGJvdW5kYXJ5V2lkdGhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGJvdW5kYXJ5SGVpZ2h0XG4gICAqIEBwYXJhbSB7QXJyYXl9IFtvcmlnaW5dIFRoZSBvcmlnaW4gcG9pbnQgdG8gcmVzaXplIGZyb20uXG4gICAqICAgICBEZWZhdWx0cyB0byBbMCwgMF0gKHRvcCBsZWZ0KS5cbiAgICovXG4gIGNvbnN0cmFpblRvQm91bmRhcnkoXG4gICAgYm91bmRhcnlXaWR0aDogYW55LFxuICAgIGJvdW5kYXJ5SGVpZ2h0OiBhbnksXG4gICAgb3JpZ2luID0gWzAsIDBdXG4gICkge1xuICAgIC8vIENhbGN1bGF0ZSB0aGUgbWF4aW11bSBzaXplcyBmb3IgZWFjaCBkaXJlY3Rpb24gb2YgZ3Jvd3RoXG4gICAgY29uc3QgW29yaWdpblgsIG9yaWdpblldID0gdGhpcy5nZXRBYnNvbHV0ZVBvaW50KG9yaWdpbik7XG4gICAgY29uc3QgbWF4SWZMZWZ0ID0gb3JpZ2luWDtcbiAgICBjb25zdCBtYXhJZlRvcCA9IG9yaWdpblk7XG4gICAgY29uc3QgbWF4SWZSaWdodCA9IGJvdW5kYXJ5V2lkdGggLSBvcmlnaW5YO1xuICAgIGNvbnN0IG1heElmQm90dG9tID0gYm91bmRhcnlIZWlnaHQgLSBvcmlnaW5ZO1xuXG4gICAgLy8gRXhwcmVzcyB0aGUgZGlyZWN0aW9uIG9mIGdyb3d0aCBpbiB0ZXJtcyBvZiBsZWZ0LCBib3RoLFxuICAgIC8vIGFuZCByaWdodCBhcyAtMSwgMCwgYW5kIDEgcmVzcGVjdGl2ZWx5LiBEaXR0byBmb3IgdG9wL2JvdGgvZG93bi5cbiAgICBjb25zdCBkaXJlY3Rpb25YID0gLTIgKiBvcmlnaW5bMF0gKyAxO1xuICAgIGNvbnN0IGRpcmVjdGlvblkgPSAtMiAqIG9yaWdpblsxXSArIDE7XG5cbiAgICAvLyBEZXRlcm1pbmUgdGhlIG1heCBzaXplIHRvIHVzZSBhY2NvcmRpbmcgdG8gdGhlIGRpcmVjdGlvbiBvZiBncm93dGguXG4gICAgbGV0IFttYXhXaWR0aCwgbWF4SGVpZ2h0XTogW2FueSwgYW55XSA9IFtudWxsLCBudWxsXTtcbiAgICBzd2l0Y2ggKGRpcmVjdGlvblgpIHtcbiAgICAgIGNhc2UgLTE6XG4gICAgICAgIG1heFdpZHRoID0gbWF4SWZMZWZ0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgbWF4V2lkdGggPSAoTWF0aC5taW4obWF4SWZMZWZ0LCBtYXhJZlJpZ2h0KSAqIDIpIGFzIGFueTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICsxOlxuICAgICAgICBtYXhXaWR0aCA9IG1heElmUmlnaHQgYXMgYW55O1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgc3dpdGNoIChkaXJlY3Rpb25ZKSB7XG4gICAgICBjYXNlIC0xOlxuICAgICAgICBtYXhIZWlnaHQgPSBtYXhJZlRvcDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIG1heEhlaWdodCA9IChNYXRoLm1pbihtYXhJZlRvcCwgbWF4SWZCb3R0b20pICogMikgYXMgYW55O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgKzE6XG4gICAgICAgIG1heEhlaWdodCA9IG1heElmQm90dG9tIGFzIGFueTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gUmVzaXplIGlmIHRoZSBib3ggZXhjZWVkcyB0aGUgY2FsY3VsYXRlZCBtYXggd2lkdGgvaGVpZ2h0LlxuICAgIGlmICh0aGlzLndpZHRoKCkgPiBtYXhXaWR0aCkge1xuICAgICAgY29uc3QgZmFjdG9yID0gbWF4V2lkdGggLyB0aGlzLndpZHRoKCk7XG4gICAgICB0aGlzLnNjYWxlKGZhY3Rvciwgb3JpZ2luKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaGVpZ2h0KCkgPiBtYXhIZWlnaHQpIHtcbiAgICAgIGNvbnN0IGZhY3RvciA9IG1heEhlaWdodCAvIHRoaXMuaGVpZ2h0KCk7XG4gICAgICB0aGlzLnNjYWxlKGZhY3Rvciwgb3JpZ2luKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJhaW4gdGhlIGJveCB0byBhIG1heGltdW0vbWluaW11bSBzaXplLlxuICAgKiBAcGFyYW0ge051bWJlcn0gW21heFdpZHRoXVxuICAgKiBAcGFyYW0ge051bWJlcn0gW21heEhlaWdodF1cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW5XaWR0aF1cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW5IZWlnaHRdXG4gICAqIEBwYXJhbSB7QXJyYXl9IFtvcmlnaW5dIFRoZSBvcmlnaW4gcG9pbnQgdG8gcmVzaXplIGZyb20uXG4gICAqICAgICBEZWZhdWx0cyB0byBbMCwgMF0gKHRvcCBsZWZ0KS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtyYXRpb10gUmF0aW8gdG8gbWFpbnRhaW4uXG4gICAqL1xuICBjb25zdHJhaW5Ub1NpemUoXG4gICAgbWF4V2lkdGg6IGFueSA9IG51bGwsXG4gICAgbWF4SGVpZ2h0OiBhbnkgPSBudWxsLFxuICAgIG1pbldpZHRoOiBhbnkgPSBudWxsLFxuICAgIG1pbkhlaWdodDogYW55ID0gbnVsbCxcbiAgICBvcmlnaW4gPSBbMCwgMF0sXG4gICAgcmF0aW86IGFueSA9IG51bGxcbiAgKSB7XG4gICAgLy8gQ2FsY3VsYXRlIG5ldyBtYXgvbWluIHdpZHRocyAmIGhlaWdodHMgdGhhdCBjb25zdHJhaW5zIHRvIHRoZSByYXRpb1xuICAgIGlmIChyYXRpbykge1xuICAgICAgaWYgKHJhdGlvID4gMSkge1xuICAgICAgICBtYXhXaWR0aCA9IChtYXhIZWlnaHQgKiAxKSAvIHJhdGlvO1xuICAgICAgICBtaW5IZWlnaHQgPSBtaW5IZWlnaHQgKiByYXRpbztcbiAgICAgIH0gZWxzZSBpZiAocmF0aW8gPCAxKSB7XG4gICAgICAgIG1heEhlaWdodCA9IG1heFdpZHRoICogcmF0aW87XG4gICAgICAgIG1pbldpZHRoID0gKG1pbkhlaWdodCAqIDEpIC8gcmF0aW87XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1heFdpZHRoICYmIHRoaXMud2lkdGgoKSA+IG1heFdpZHRoKSB7XG4gICAgICBjb25zdCBuZXdXaWR0aCA9IG1heFdpZHRoLFxuICAgICAgICBuZXdIZWlnaHQgPSByYXRpbyA9PT0gbnVsbCA/IHRoaXMuaGVpZ2h0KCkgOiBtYXhIZWlnaHQ7XG4gICAgICB0aGlzLnJlc2l6ZShuZXdXaWR0aCwgbmV3SGVpZ2h0LCBvcmlnaW4pO1xuICAgIH1cblxuICAgIGlmIChtYXhIZWlnaHQgJiYgdGhpcy5oZWlnaHQoKSA+IG1heEhlaWdodCkge1xuICAgICAgY29uc3QgbmV3V2lkdGggPSByYXRpbyA9PT0gbnVsbCA/IHRoaXMud2lkdGgoKSA6IG1heFdpZHRoLFxuICAgICAgICBuZXdIZWlnaHQgPSBtYXhIZWlnaHQ7XG4gICAgICB0aGlzLnJlc2l6ZShuZXdXaWR0aCwgbmV3SGVpZ2h0LCBvcmlnaW4pO1xuICAgIH1cblxuICAgIGlmIChtaW5XaWR0aCAmJiB0aGlzLndpZHRoKCkgPCBtaW5XaWR0aCkge1xuICAgICAgY29uc3QgbmV3V2lkdGggPSBtaW5XaWR0aCxcbiAgICAgICAgbmV3SGVpZ2h0ID0gcmF0aW8gPT09IG51bGwgPyB0aGlzLmhlaWdodCgpIDogbWluSGVpZ2h0O1xuICAgICAgdGhpcy5yZXNpemUobmV3V2lkdGgsIG5ld0hlaWdodCwgb3JpZ2luKTtcbiAgICB9XG5cbiAgICBpZiAobWluSGVpZ2h0ICYmIHRoaXMuaGVpZ2h0KCkgPCBtaW5IZWlnaHQpIHtcbiAgICAgIGNvbnN0IG5ld1dpZHRoID0gcmF0aW8gPT09IG51bGwgPyB0aGlzLndpZHRoKCkgOiBtaW5XaWR0aCxcbiAgICAgICAgbmV3SGVpZ2h0ID0gbWluSGVpZ2h0O1xuICAgICAgdGhpcy5yZXNpemUobmV3V2lkdGgsIG5ld0hlaWdodCwgb3JpZ2luKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuIl19