import { Component, Input, Output, EventEmitter, ViewEncapsulation, ViewChild, ChangeDetectionStrategy, } from '@angular/core';
import { convertImageUsingCanvas } from './functions/image-processing';
import labelEs from './i18n/es.json';
import labelEn from './i18n/en.json';
import labelFr from './i18n/fr.json';
import labelDe from './i18n/de.json';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./components/edit-image/edit-image.component";
export class NgpImagePickerComponent {
    constructor(chRef) {
        this.chRef = chRef;
        this.config = {
            language: 'en',
            objectFit: 'cover',
            hideDeleteBtn: false,
            hideDownloadBtn: false,
            hideEditBtn: false,
            hideAddBtn: false,
        };
        this.state = {
            quality: 92,
            maxHeight: 1000,
            maxWidth: 1000,
            cropHeight: 150,
            cropWidth: 150,
            maintainAspectRatio: true,
            format: 'jpeg',
            arrayCopiedImages: [],
            originImageSrc: '',
        };
        this.loadImage = false;
        this.fileType = '';
        this.urlImage = '';
        this.uuidFilePicker = Date.now().toString(20);
        this.showEditPanel = false;
        this.imageName = 'donload';
        this.labels = labelEn;
        this.arrayCopiedImages = [];
        this.color = '#1e88e5';
        this.imagePicker = null;
        this.$imageChanged = new EventEmitter();
        this.$imageOriginal = new EventEmitter();
    }
    set _imageSrc(value) {
        if (value) {
            this.parseToBase64(value).then((dataUri) => {
                this.imageSrc = dataUri;
                this.state.originImageSrc = value;
                this.state.arrayCopiedImages.push({
                    lastImage: dataUri,
                    width: this.state.maxWidth,
                    height: this.state.maxHeight,
                    quality: this.state.quality,
                    format: this.state.format,
                    originImageSrc: value,
                });
                this.$imageOriginal.next(this.state.originImageSrc);
                this.loadImage = true;
                this.chRef.markForCheck();
            });
        }
        else {
            this.imageSrc = null;
            this.state.originImageSrc = null;
            this.loadImage = false;
            this.state.arrayCopiedImages = [];
            this.$imageOriginal.next(null);
            this.state = {
                ...this.state,
                format: 'jpeg',
                maxHeight: 1000,
                maxWidth: 1000,
                cropHeight: 150,
                cropWidth: 150,
                maintainAspectRatio: true,
            };
            this.showEditPanel = false;
            this.chRef.markForCheck();
        }
    }
    set _config(value) {
        this.processConfig(value);
    }
    ngOnInit() {
        this.appendLinkIconsToHead();
    }
    appendLinkIconsToHead() {
        let head = document.head;
        let linkIcons = head.querySelector('#ngp-image-picker-icons-id');
        if (linkIcons)
            return;
        let link = document.createElement('link');
        link.href = 'https://fonts.googleapis.com/icon?family=Material+Icons';
        link.rel = 'stylesheet';
        link.id = 'ngp-image-picker-icons-id';
        head.appendChild(link);
    }
    onUpload(event) {
        event.preventDefault();
        this.imagePicker?.nativeElement.click();
    }
    handleFileSelect(evt) {
        const files = evt.target?.files;
        if (files) {
            const file = files[0];
            this.imageName = file.name.split('.')[0];
            this.fileType = file.type;
            if (!this.fileType.includes('image'))
                return;
            this.urlImage = `data:${file.type};base64,`;
            if (file) {
                this.state.format = this.fileType.split('image/')[1];
                const reader = new FileReader();
                reader.onload = this.handleReaderLoaded.bind(this);
                reader.readAsBinaryString(file);
            }
        }
    }
    async handleReaderLoaded(readerEvt) {
        const binaryString = readerEvt.target.result;
        const base64textString = btoa(binaryString);
        this.state.originImageSrc = this.urlImage + base64textString;
        if (this.config.compressInitial) {
            this.state = {
                ...this.state,
                quality: Math.min(this.config.compressInitial || 92, 100),
                maintainAspectRatio: true,
                format: 'jpeg',
            };
            this.imageSrc = await convertImageUsingCanvas(this.urlImage + base64textString, false, this.state, { getDimFromImage: true });
        }
        else {
            this.imageSrc = this.urlImage + base64textString;
            let img = document.createElement('img');
            img.src = this.imageSrc;
            img.onload = () => {
                this.state.arrayCopiedImages = [];
                this.state.maxHeight = img.height;
                this.state.maxWidth = img.width;
                this.state.arrayCopiedImages.push({
                    lastImage: this.imageSrc,
                    width: img.width,
                    height: img.height,
                    quality: this.state.quality,
                    format: this.state.format,
                    originImageSrc: this.state.originImageSrc,
                });
            };
        }
        this.$imageChanged.next(this.imageSrc);
        this.loadImage = true;
        this.chRef.markForCheck();
    }
    onOpenEditPanel() {
        this.showEditPanel = true;
    }
    onCloseEditPanel(data) {
        if (data) {
            this.state = data.state;
            this.imageSrc = data.imageSrc;
            this.$imageChanged.next(this.imageSrc);
        }
        this.showEditPanel = false;
    }
    parseToBase64(imageUrl) {
        let types = imageUrl.split('.');
        let type = types[types.length - 1];
        if (type && (type == 'png' || type == 'jpeg' || type == 'webp')) {
            type = type;
        }
        else {
            type = 'jpeg';
        }
        this.state = {
            ...this.state,
            format: type,
        };
        return new Promise((resolve, reject) => {
            let img = new Image();
            img.crossOrigin = 'Anonymous';
            this.state = {
                ...this.state,
                maxHeight: img.height,
                maxWidth: img.width,
            };
            img.onload = () => {
                let canvas = document.createElement('canvas');
                let ctx = canvas.getContext('2d');
                if (!ctx)
                    return;
                let ratio = 1.0;
                canvas.width = img.width * ratio;
                canvas.height = img.height * ratio;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                let dataURI = canvas.toDataURL(`image/${type}`, this.state.quality);
                return resolve({
                    dataUri: dataURI,
                    width: canvas.width,
                    height: canvas.height,
                });
            };
            img.onerror = (e) => {
                return reject(e.message || `Error loading the src = ${imageUrl}`);
            };
            img.src = imageUrl;
        }).then((data) => {
            this.state = {
                ...this.state,
                maxHeight: data.height,
                maxWidth: data.width,
            };
            return data.dataUri;
        });
    }
    processConfig(value) {
        if (value && value.constructor == Object) {
            this.config = { ...this.config, ...value };
            if (value.language != undefined) {
                if (value.language == 'en') {
                    this.labels = { ...labelEn };
                }
                if (value.language == 'es') {
                    this.labels = { ...labelEs };
                }
                if (value.language == 'fr') {
                    this.labels = { ...labelFr };
                }
                if (value.language == 'de') {
                    this.labels = { ...labelDe };
                }
            }
        }
    }
    calculateSize() {
        if (this.imageSrc && this.imageSrc.length) {
            return Math.ceil(((3 / 4) * this.imageSrc.length) / 1024);
        }
        else {
            return 0;
        }
    }
    ////////////////////////////////////////////////
    onRemove() {
        this.imageSrc = null;
        this.loadImage = false;
        this.$imageOriginal.next(null);
        this.$imageChanged.next(null);
        this.state = {
            ...this.state,
            originImageSrc: '',
            format: 'jpeg',
            maxHeight: 1000,
            maxWidth: 1000,
            cropHeight: 150,
            cropWidth: 150,
            maintainAspectRatio: true,
            arrayCopiedImages: [],
            basicFilters: undefined,
            quality: 92,
        };
        this.showEditPanel = false;
    }
}
NgpImagePickerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: NgpImagePickerComponent, deps: [{ token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
NgpImagePickerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.0.4", type: NgpImagePickerComponent, selector: "ngp-image-picker", inputs: { color: "color", _imageSrc: "_imageSrc", _config: "_config" }, outputs: { $imageChanged: "$imageChanged", $imageOriginal: "$imageOriginal" }, viewQueries: [{ propertyName: "imagePicker", first: true, predicate: ["imagePicker"], descendants: true }], ngImport: i0, template: "<div *ngIf=\"!loadImage\" class=\"place-image\">\n  <div\n    class=\"image-holder\"\n    [ngStyle]=\"{\n      width: this.config.width,\n      height: this.config.height,\n      borderRadius: this.config.borderRadius,\n      aspectRatio: this.config.aspectRatio\n    }\"\n  >\n    <button title=\"{{ labels['Upload a image'] }}\" class=\"icon-btn image-upload-btn\" (click)=\"onUpload($event)\">\n      <!--  <span class=\"material-icons\">add_a_photo</mat-icon> -->\n      <span class=\"material-icons\">add_a_photo</span>\n    </button>\n\n    <input #imagePicker type=\"file\" style=\"display: none\" [id]=\"'filePicker-' + this.uuidFilePicker\" (change)=\"handleFileSelect($event)\" />\n  </div>\n</div>\n<div *ngIf=\"loadImage\" class=\"place-image\">\n  <div\n    class=\"image-holder-loaded\"\n    [ngStyle]=\"{\n      width: this.config.width,\n      height: this.config.height,\n      borderRadius: this.config.borderRadius,\n      aspectRatio: this.config.aspectRatio\n    }\"\n  >\n    <img\n      [src]=\"this.imageSrc\"\n      alt=\"image-loaded\"\n      [ngStyle]=\"{ borderRadius: this.config.borderRadius, objectFit: this.config.objectFit }\"\n    />\n    <input #imagePicker type=\"file\" style=\"display: none\" [id]=\"'filePicker-' + this.uuidFilePicker\" (change)=\"handleFileSelect($event)\" />\n  </div>\n  <p\n    *ngIf=\"this.calculateSize()\"\n    class=\"caption image-caption\"\n    [ngStyle]=\"{\n      color: this.calculateSize() > 120 ? '#f44336' : 'unset',\n      fontWeight: this.calculateSize() > 120 ? '500' : 'unset'\n    }\"\n  >\n    size: {{ this.calculateSize() }}Kb &nbsp; {{ this.state.format }}\n  </p>\n\n  <div\n    style=\"flex-direction: row; box-sizing: border-box; display: flex; place-content: flex-start; align-items: flex-start\"\n    class=\"editing-bar-btn\"\n  >\n    <button\n      class=\"icon-btn\"\n      id=\"upload-img\"\n      *ngIf=\"!this.config.hideAddBtn\"\n      title=\"{{ labels['Upload a image'] }}\"\n      (click)=\"onUpload($event)\"\n    >\n      <span class=\"material-icons\">add_a_photo</span>\n    </button>\n    <button\n      class=\"icon-btn\"\n      id=\"edit-img\"\n      *ngIf=\"!this.config.hideEditBtn\"\n      title=\"{{ labels['Open the editor panel'] }}\"\n      (click)=\"onOpenEditPanel()\"\n    >\n      <span class=\"material-icons\">edit</span>\n    </button>\n    <a\n      id=\"download-img\"\n      *ngIf=\"!this.config.hideDownloadBtn\"\n      title=\"{{ labels['Download the image'] }}\"\n      [href]=\"this.imageSrc\"\n      download=\"{{ imageName }}\"\n    >\n      <span class=\"material-icons\">cloud_download</span>\n    </a>\n    <button class=\"icon-btn\" id=\"delete-img\" *ngIf=\"!this.config.hideDeleteBtn\" title=\"{{ labels['Remove'] }}\" (click)=\"onRemove()\">\n      <span class=\"material-icons\">delete</span>\n    </button>\n  </div>\n</div>\n\n<lib-edit-image\n  *ngIf=\"showEditPanel\"\n  [imageSrc]=\"this.imageSrc\"\n  [initialState]=\"this.state\"\n  [labels]=\"this.labels\"\n  [color]=\"this.color\"\n  (closeModal)=\"this.onCloseEditPanel($event)\"\n></lib-edit-image>\n", styles: ["ngp-image-picker p{margin:0!important;padding:0!important}ngp-image-picker .place-image{flex-direction:column;box-sizing:border-box;display:flex;place-content:flex-start;align-items:flex-start}ngp-image-picker .place-image .image-holder{flex-direction:column;display:flex;place-content:center;align-items:center;position:relative;border-radius:16px;max-width:100%!important;box-sizing:border-box;border:2px rgba(0,0,0,.3) solid;background-color:#fcfcfc}@media (max-width: 599px){ngp-image-picker .place-image .image-holder{max-width:100%!important;max-height:250px!important}}ngp-image-picker .place-image .image-holder .image-upload-btn{transition:all .5s ease;position:relative;opacity:.85;width:50px;height:50px;color:#424242}ngp-image-picker .place-image .image-holder .image-upload-btn .material-icons{font-size:50px;width:50px;height:50px;line-height:50px;color:#424242}@media (max-width: 599px){ngp-image-picker .place-image .image-holder .image-upload-btn{opacity:1;width:30px;height:30px}ngp-image-picker .place-image .image-holder .image-upload-btn .material-icons{font-size:30px;width:30px;height:30px;line-height:30px}}ngp-image-picker .place-image .image-holder:hover .image-upload-btn{opacity:1;transition:all .5s ease}ngp-image-picker .place-image .image-holder-loaded{flex-direction:column;display:flex;place-content:center;align-items:center;position:relative;max-width:100%!important;border-radius:4px;box-sizing:border-box;padding:2px}ngp-image-picker .place-image .image-holder-loaded .image-caption{position:absolute;right:0;bottom:-22px}ngp-image-picker .place-image .image-holder-loaded img{height:100%;max-height:100%;width:100%;max-width:100%;object-position:center;background:black}@media (max-width: 599px){ngp-image-picker .place-image .image-holder-loaded{max-height:195px!important}}ngp-image-picker .place-image .image-holder-loaded .image-upload-btn{transition:all .5s ease;position:relative;opacity:.85;width:50px;height:50px;color:#424242}ngp-image-picker .place-image .image-holder-loaded .image-upload-btn .material-icons{font-size:50px;width:50px;height:50px;line-height:50px;color:#424242}@media (max-width: 599px){ngp-image-picker .place-image .image-holder-loaded .image-upload-btn{opacity:1;width:30px;height:30px}ngp-image-picker .place-image .image-holder-loaded .image-upload-btn .material-icons{font-size:30px;width:30px;height:30px;line-height:30px}}ngp-image-picker .place-image .image-holder-loaded:hover .image-upload-btn{opacity:1;transition:all .5s ease}ngp-image-picker .place-image .editing-bar-btn{margin-top:2px}ngp-image-picker .place-image .editing-bar-btn .material-icons-button{height:20px;line-height:20px;width:24px}ngp-image-picker .place-image .editing-bar-btn .material-icons{line-height:20px!important;font-size:20px!important;width:20px!important;height:20px!important}ngp-image-picker .place-image .editing-bar-btn button{margin:4px;color:#424242;transition:all .5s ease}ngp-image-picker .place-image .editing-bar-btn button:hover{transition:all .25s ease-in}ngp-image-picker .place-image .editing-bar-btn a{margin:4px;color:#424242;transition:all .5s ease}ngp-image-picker .place-image .editing-bar-btn a:hover{transition:all .25s ease-in}@keyframes show{0%{top:-100vh;opacity:0}to{top:0;opacity:1}}ngp-image-picker .btn{padding:4px 8px;border-radius:4px;cursor:pointer}ngp-image-picker .btn .material-icons{color:#000000d1}ngp-image-picker .icon-btn{display:flex;justify-content:center;align-items:center;border:none;background-color:inherit;border-radius:50%;cursor:pointer}ngp-image-picker .icon-btn :active{transform:scale(.95)}ngp-image-picker .caption{font-size:11px;margin-top:2px!important;margin-bottom:0!important}ngp-image-picker button[disabled]{filter:brightness(.5);cursor:not-allowed}ngp-image-picker .croppr-container *{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}ngp-image-picker .croppr-container img{vertical-align:middle;max-width:100%;max-height:650px;object-fit:cover;object-position:center}ngp-image-picker .croppr{position:relative;display:inline-block}ngp-image-picker .croppr-overlay{background:rgba(0,0,0,.5);position:absolute;inset:0;z-index:1;cursor:crosshair}ngp-image-picker .croppr-region{border:1px dashed rgba(0,0,0,.5);position:absolute;z-index:3;cursor:move;top:0;display:grid;gap:0px;grid-template-columns:repeat(3,1fr)}ngp-image-picker .croppr-imageClipped{position:absolute;inset:0;z-index:2;pointer-events:none}ngp-image-picker .croppr-handle{border:1px solid #ccc;background-color:#fafafa;width:14px;height:14px;position:absolute;z-index:4;top:0;border-radius:50%}\n"], dependencies: [{ kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "component", type: i2.EditImageComponent, selector: "lib-edit-image", inputs: ["labels", "imageSrc", "color", "initialState"], outputs: ["closeModal"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: NgpImagePickerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ngp-image-picker', encapsulation: ViewEncapsulation.None, changeDetection: ChangeDetectionStrategy.OnPush, template: "<div *ngIf=\"!loadImage\" class=\"place-image\">\n  <div\n    class=\"image-holder\"\n    [ngStyle]=\"{\n      width: this.config.width,\n      height: this.config.height,\n      borderRadius: this.config.borderRadius,\n      aspectRatio: this.config.aspectRatio\n    }\"\n  >\n    <button title=\"{{ labels['Upload a image'] }}\" class=\"icon-btn image-upload-btn\" (click)=\"onUpload($event)\">\n      <!--  <span class=\"material-icons\">add_a_photo</mat-icon> -->\n      <span class=\"material-icons\">add_a_photo</span>\n    </button>\n\n    <input #imagePicker type=\"file\" style=\"display: none\" [id]=\"'filePicker-' + this.uuidFilePicker\" (change)=\"handleFileSelect($event)\" />\n  </div>\n</div>\n<div *ngIf=\"loadImage\" class=\"place-image\">\n  <div\n    class=\"image-holder-loaded\"\n    [ngStyle]=\"{\n      width: this.config.width,\n      height: this.config.height,\n      borderRadius: this.config.borderRadius,\n      aspectRatio: this.config.aspectRatio\n    }\"\n  >\n    <img\n      [src]=\"this.imageSrc\"\n      alt=\"image-loaded\"\n      [ngStyle]=\"{ borderRadius: this.config.borderRadius, objectFit: this.config.objectFit }\"\n    />\n    <input #imagePicker type=\"file\" style=\"display: none\" [id]=\"'filePicker-' + this.uuidFilePicker\" (change)=\"handleFileSelect($event)\" />\n  </div>\n  <p\n    *ngIf=\"this.calculateSize()\"\n    class=\"caption image-caption\"\n    [ngStyle]=\"{\n      color: this.calculateSize() > 120 ? '#f44336' : 'unset',\n      fontWeight: this.calculateSize() > 120 ? '500' : 'unset'\n    }\"\n  >\n    size: {{ this.calculateSize() }}Kb &nbsp; {{ this.state.format }}\n  </p>\n\n  <div\n    style=\"flex-direction: row; box-sizing: border-box; display: flex; place-content: flex-start; align-items: flex-start\"\n    class=\"editing-bar-btn\"\n  >\n    <button\n      class=\"icon-btn\"\n      id=\"upload-img\"\n      *ngIf=\"!this.config.hideAddBtn\"\n      title=\"{{ labels['Upload a image'] }}\"\n      (click)=\"onUpload($event)\"\n    >\n      <span class=\"material-icons\">add_a_photo</span>\n    </button>\n    <button\n      class=\"icon-btn\"\n      id=\"edit-img\"\n      *ngIf=\"!this.config.hideEditBtn\"\n      title=\"{{ labels['Open the editor panel'] }}\"\n      (click)=\"onOpenEditPanel()\"\n    >\n      <span class=\"material-icons\">edit</span>\n    </button>\n    <a\n      id=\"download-img\"\n      *ngIf=\"!this.config.hideDownloadBtn\"\n      title=\"{{ labels['Download the image'] }}\"\n      [href]=\"this.imageSrc\"\n      download=\"{{ imageName }}\"\n    >\n      <span class=\"material-icons\">cloud_download</span>\n    </a>\n    <button class=\"icon-btn\" id=\"delete-img\" *ngIf=\"!this.config.hideDeleteBtn\" title=\"{{ labels['Remove'] }}\" (click)=\"onRemove()\">\n      <span class=\"material-icons\">delete</span>\n    </button>\n  </div>\n</div>\n\n<lib-edit-image\n  *ngIf=\"showEditPanel\"\n  [imageSrc]=\"this.imageSrc\"\n  [initialState]=\"this.state\"\n  [labels]=\"this.labels\"\n  [color]=\"this.color\"\n  (closeModal)=\"this.onCloseEditPanel($event)\"\n></lib-edit-image>\n", styles: ["ngp-image-picker p{margin:0!important;padding:0!important}ngp-image-picker .place-image{flex-direction:column;box-sizing:border-box;display:flex;place-content:flex-start;align-items:flex-start}ngp-image-picker .place-image .image-holder{flex-direction:column;display:flex;place-content:center;align-items:center;position:relative;border-radius:16px;max-width:100%!important;box-sizing:border-box;border:2px rgba(0,0,0,.3) solid;background-color:#fcfcfc}@media (max-width: 599px){ngp-image-picker .place-image .image-holder{max-width:100%!important;max-height:250px!important}}ngp-image-picker .place-image .image-holder .image-upload-btn{transition:all .5s ease;position:relative;opacity:.85;width:50px;height:50px;color:#424242}ngp-image-picker .place-image .image-holder .image-upload-btn .material-icons{font-size:50px;width:50px;height:50px;line-height:50px;color:#424242}@media (max-width: 599px){ngp-image-picker .place-image .image-holder .image-upload-btn{opacity:1;width:30px;height:30px}ngp-image-picker .place-image .image-holder .image-upload-btn .material-icons{font-size:30px;width:30px;height:30px;line-height:30px}}ngp-image-picker .place-image .image-holder:hover .image-upload-btn{opacity:1;transition:all .5s ease}ngp-image-picker .place-image .image-holder-loaded{flex-direction:column;display:flex;place-content:center;align-items:center;position:relative;max-width:100%!important;border-radius:4px;box-sizing:border-box;padding:2px}ngp-image-picker .place-image .image-holder-loaded .image-caption{position:absolute;right:0;bottom:-22px}ngp-image-picker .place-image .image-holder-loaded img{height:100%;max-height:100%;width:100%;max-width:100%;object-position:center;background:black}@media (max-width: 599px){ngp-image-picker .place-image .image-holder-loaded{max-height:195px!important}}ngp-image-picker .place-image .image-holder-loaded .image-upload-btn{transition:all .5s ease;position:relative;opacity:.85;width:50px;height:50px;color:#424242}ngp-image-picker .place-image .image-holder-loaded .image-upload-btn .material-icons{font-size:50px;width:50px;height:50px;line-height:50px;color:#424242}@media (max-width: 599px){ngp-image-picker .place-image .image-holder-loaded .image-upload-btn{opacity:1;width:30px;height:30px}ngp-image-picker .place-image .image-holder-loaded .image-upload-btn .material-icons{font-size:30px;width:30px;height:30px;line-height:30px}}ngp-image-picker .place-image .image-holder-loaded:hover .image-upload-btn{opacity:1;transition:all .5s ease}ngp-image-picker .place-image .editing-bar-btn{margin-top:2px}ngp-image-picker .place-image .editing-bar-btn .material-icons-button{height:20px;line-height:20px;width:24px}ngp-image-picker .place-image .editing-bar-btn .material-icons{line-height:20px!important;font-size:20px!important;width:20px!important;height:20px!important}ngp-image-picker .place-image .editing-bar-btn button{margin:4px;color:#424242;transition:all .5s ease}ngp-image-picker .place-image .editing-bar-btn button:hover{transition:all .25s ease-in}ngp-image-picker .place-image .editing-bar-btn a{margin:4px;color:#424242;transition:all .5s ease}ngp-image-picker .place-image .editing-bar-btn a:hover{transition:all .25s ease-in}@keyframes show{0%{top:-100vh;opacity:0}to{top:0;opacity:1}}ngp-image-picker .btn{padding:4px 8px;border-radius:4px;cursor:pointer}ngp-image-picker .btn .material-icons{color:#000000d1}ngp-image-picker .icon-btn{display:flex;justify-content:center;align-items:center;border:none;background-color:inherit;border-radius:50%;cursor:pointer}ngp-image-picker .icon-btn :active{transform:scale(.95)}ngp-image-picker .caption{font-size:11px;margin-top:2px!important;margin-bottom:0!important}ngp-image-picker button[disabled]{filter:brightness(.5);cursor:not-allowed}ngp-image-picker .croppr-container *{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}ngp-image-picker .croppr-container img{vertical-align:middle;max-width:100%;max-height:650px;object-fit:cover;object-position:center}ngp-image-picker .croppr{position:relative;display:inline-block}ngp-image-picker .croppr-overlay{background:rgba(0,0,0,.5);position:absolute;inset:0;z-index:1;cursor:crosshair}ngp-image-picker .croppr-region{border:1px dashed rgba(0,0,0,.5);position:absolute;z-index:3;cursor:move;top:0;display:grid;gap:0px;grid-template-columns:repeat(3,1fr)}ngp-image-picker .croppr-imageClipped{position:absolute;inset:0;z-index:2;pointer-events:none}ngp-image-picker .croppr-handle{border:1px solid #ccc;background-color:#fafafa;width:14px;height:14px;position:absolute;z-index:4;top:0;border-radius:50%}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }]; }, propDecorators: { color: [{
                type: Input
            }], _imageSrc: [{
                type: Input
            }], _config: [{
                type: Input
            }], imagePicker: [{
                type: ViewChild,
                args: ['imagePicker', { static: false }]
            }], $imageChanged: [{
                type: Output
            }], $imageOriginal: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmdwLWltYWdlLXBpY2tlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3AtaW1hZ2UtcGlja2VyL3NyYy9saWIvbmdwLWltYWdlLXBpY2tlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3AtaW1hZ2UtcGlja2VyL3NyYy9saWIvbmdwLWltYWdlLXBpY2tlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLGlCQUFpQixFQUNqQixTQUFTLEVBRVQsdUJBQXVCLEdBRXhCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRXZFLE9BQU8sT0FBTyxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sT0FBTyxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sT0FBTyxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sT0FBTyxNQUFNLGdCQUFnQixDQUFDOzs7O0FBU3JDLE1BQU0sT0FBTyx1QkFBdUI7SUE4RWxDLFlBQW9CLEtBQXdCO1FBQXhCLFVBQUssR0FBTCxLQUFLLENBQW1CO1FBN0U1QyxXQUFNLEdBQW9CO1lBQ3hCLFFBQVEsRUFBRSxJQUFJO1lBQ2QsU0FBUyxFQUFFLE9BQU87WUFDbEIsYUFBYSxFQUFFLEtBQUs7WUFDcEIsZUFBZSxFQUFFLEtBQUs7WUFDdEIsV0FBVyxFQUFFLEtBQUs7WUFDbEIsVUFBVSxFQUFFLEtBQUs7U0FDbEIsQ0FBQztRQUVGLFVBQUssR0FBVztZQUNkLE9BQU8sRUFBRSxFQUFFO1lBQ1gsU0FBUyxFQUFFLElBQUk7WUFDZixRQUFRLEVBQUUsSUFBSTtZQUNkLFVBQVUsRUFBRSxHQUFHO1lBQ2YsU0FBUyxFQUFFLEdBQUc7WUFDZCxtQkFBbUIsRUFBRSxJQUFJO1lBQ3pCLE1BQU0sRUFBRSxNQUFNO1lBQ2QsaUJBQWlCLEVBQUUsRUFBRTtZQUNyQixjQUFjLEVBQUUsRUFBRTtTQUNuQixDQUFDO1FBRUYsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixhQUFRLEdBQVcsRUFBRSxDQUFDO1FBQ3RCLGFBQVEsR0FBVyxFQUFFLENBQUM7UUFDdEIsbUJBQWMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFDdEIsV0FBTSxHQUFRLE9BQU8sQ0FBQztRQUN0QixzQkFBaUIsR0FBVSxFQUFFLENBQUM7UUFFckIsVUFBSyxHQUFXLFNBQVMsQ0FBQztRQTJDVSxnQkFBVyxHQUFrQyxJQUFJLENBQUM7UUFDckYsa0JBQWEsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUMzRCxtQkFBYyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO0lBRXZCLENBQUM7SUE3Q2hELElBQWEsU0FBUyxDQUFDLEtBQVU7UUFDL0IsSUFBSSxLQUFLLEVBQUU7WUFDVCxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO2dCQUN6QyxJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztnQkFDeEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO2dCQUNsQyxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztvQkFDaEMsU0FBUyxFQUFFLE9BQU87b0JBQ2xCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVE7b0JBQzFCLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVM7b0JBQzVCLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU87b0JBQzNCLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07b0JBQ3pCLGNBQWMsRUFBRSxLQUFLO2lCQUN0QixDQUFDLENBQUM7Z0JBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDcEQsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDNUIsQ0FBQyxDQUFDLENBQUM7U0FDSjthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDckIsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1lBQ2pDLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEdBQUcsRUFBRSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUc7Z0JBQ1gsR0FBRyxJQUFJLENBQUMsS0FBSztnQkFDYixNQUFNLEVBQUUsTUFBTTtnQkFDZCxTQUFTLEVBQUUsSUFBSTtnQkFDZixRQUFRLEVBQUUsSUFBSTtnQkFDZCxVQUFVLEVBQUUsR0FBRztnQkFDZixTQUFTLEVBQUUsR0FBRztnQkFDZCxtQkFBbUIsRUFBRSxJQUFJO2FBQzFCLENBQUM7WUFDRixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztZQUMzQixJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQztJQUVELElBQWEsT0FBTyxDQUFDLEtBQVU7UUFDN0IsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBUUQsUUFBUTtRQUNOLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFRCxxQkFBcUI7UUFDbkIsSUFBSSxJQUFJLEdBQWdCLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDdEMsSUFBSSxTQUFTLEdBQW1DLElBQUksQ0FBQyxhQUFhLENBQUMsNEJBQTRCLENBQWdCLENBQUM7UUFDaEgsSUFBSSxTQUFTO1lBQUUsT0FBTztRQUN0QixJQUFJLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFDLElBQUksQ0FBQyxJQUFJLEdBQUcseURBQXlELENBQUM7UUFDdEUsSUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFZLENBQUM7UUFDeEIsSUFBSSxDQUFDLEVBQUUsR0FBRywyQkFBMkIsQ0FBQztRQUN0QyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBVTtRQUNqQixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDMUMsQ0FBQztJQUVELGdCQUFnQixDQUFDLEdBQVE7UUFDdkIsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUM7UUFDaEMsSUFBSSxLQUFLLEVBQUU7WUFDVCxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFdEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztnQkFBRSxPQUFPO1lBQzdDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxJQUFJLENBQUMsSUFBSSxVQUFVLENBQUM7WUFDNUMsSUFBSSxJQUFJLEVBQUU7Z0JBQ1IsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JELE1BQU0sTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFLENBQUM7Z0JBQ2hDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbkQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ2pDO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsS0FBSyxDQUFDLGtCQUFrQixDQUFDLFNBQWM7UUFDckMsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDN0MsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxnQkFBZ0IsQ0FBQztRQUM3RCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFO1lBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUc7Z0JBQ1gsR0FBRyxJQUFJLENBQUMsS0FBSztnQkFDYixPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsSUFBSSxFQUFFLEVBQUUsR0FBRyxDQUFDO2dCQUN6RCxtQkFBbUIsRUFBRSxJQUFJO2dCQUN6QixNQUFNLEVBQUUsTUFBTTthQUNmLENBQUM7WUFDRixJQUFJLENBQUMsUUFBUSxHQUFHLE1BQU0sdUJBQXVCLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxnQkFBZ0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1NBQy9IO2FBQU07WUFDTCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsZ0JBQWdCLENBQUM7WUFDakQsSUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN4QyxHQUFHLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDeEIsR0FBRyxDQUFDLE1BQU0sR0FBRyxHQUFHLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEdBQUcsRUFBRSxDQUFDO2dCQUNsQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO2dCQUNsQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO2dCQUNoQyxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztvQkFDaEMsU0FBUyxFQUFFLElBQUksQ0FBQyxRQUFRO29CQUN4QixLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUs7b0JBQ2hCLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTTtvQkFDbEIsT0FBTyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTztvQkFDM0IsTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTtvQkFDekIsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBd0I7aUJBQ3BELENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQztTQUNIO1FBQ0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztJQUM1QixDQUFDO0lBRUQsZ0JBQWdCLENBQUMsSUFBUztRQUN4QixJQUFJLElBQUksRUFBRTtZQUNSLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUN4QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDOUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7SUFDN0IsQ0FBQztJQUVELGFBQWEsQ0FBQyxRQUFnQjtRQUM1QixJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hDLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ25DLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksTUFBTSxJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsRUFBRTtZQUMvRCxJQUFJLEdBQUcsSUFBSSxDQUFDO1NBQ2I7YUFBTTtZQUNMLElBQUksR0FBRyxNQUFNLENBQUM7U0FDZjtRQUVELElBQUksQ0FBQyxLQUFLLEdBQUc7WUFDWCxHQUFHLElBQUksQ0FBQyxLQUFLO1lBQ2IsTUFBTSxFQUFFLElBQUk7U0FDYixDQUFDO1FBRUYsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUNyQyxJQUFJLEdBQUcsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ3RCLEdBQUcsQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1lBQzlCLElBQUksQ0FBQyxLQUFLLEdBQUc7Z0JBQ1gsR0FBRyxJQUFJLENBQUMsS0FBSztnQkFDYixTQUFTLEVBQUUsR0FBRyxDQUFDLE1BQU07Z0JBQ3JCLFFBQVEsRUFBRSxHQUFHLENBQUMsS0FBSzthQUNwQixDQUFDO1lBQ0YsR0FBRyxDQUFDLE1BQU0sR0FBRyxHQUFHLEVBQUU7Z0JBQ2hCLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzlDLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2xDLElBQUksQ0FBQyxHQUFHO29CQUFFLE9BQU87Z0JBQ2pCLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQztnQkFDaEIsTUFBTSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztnQkFDakMsTUFBTSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztnQkFDbkMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdEQsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLElBQUksRUFBRSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3BFLE9BQU8sT0FBTyxDQUFDO29CQUNiLE9BQU8sRUFBRSxPQUFPO29CQUNoQixLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUs7b0JBQ25CLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTTtpQkFDdEIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDO1lBQ0YsR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQU0sRUFBRSxFQUFFO2dCQUN2QixPQUFPLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLDJCQUEyQixRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3BFLENBQUMsQ0FBQztZQUNGLEdBQUcsQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDO1FBQ3JCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQVMsRUFBRSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUc7Z0JBQ1gsR0FBRyxJQUFJLENBQUMsS0FBSztnQkFDYixTQUFTLEVBQUUsSUFBSSxDQUFDLE1BQU07Z0JBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsS0FBSzthQUNyQixDQUFDO1lBQ0YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGFBQWEsQ0FBQyxLQUFzQjtRQUNsQyxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsV0FBVyxJQUFJLE1BQU0sRUFBRTtZQUN4QyxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsS0FBSyxFQUFFLENBQUM7WUFDM0MsSUFBSSxLQUFLLENBQUMsUUFBUSxJQUFJLFNBQVMsRUFBRTtnQkFDL0IsSUFBSSxLQUFLLENBQUMsUUFBUSxJQUFJLElBQUksRUFBRTtvQkFDMUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsT0FBTyxFQUFFLENBQUM7aUJBQzlCO2dCQUNELElBQUksS0FBSyxDQUFDLFFBQVEsSUFBSSxJQUFJLEVBQUU7b0JBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxHQUFHLE9BQU8sRUFBRSxDQUFDO2lCQUM5QjtnQkFDRCxJQUFJLEtBQUssQ0FBQyxRQUFRLElBQUksSUFBSSxFQUFFO29CQUMxQixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQztpQkFDOUI7Z0JBQ0QsSUFBSSxLQUFLLENBQUMsUUFBUSxJQUFJLElBQUksRUFBRTtvQkFDMUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsT0FBTyxFQUFFLENBQUM7aUJBQzlCO2FBQ0Y7U0FDRjtJQUNILENBQUM7SUFFRCxhQUFhO1FBQ1gsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFO1lBQ3pDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDM0Q7YUFBTTtZQUNMLE9BQU8sQ0FBQyxDQUFDO1NBQ1Y7SUFDSCxDQUFDO0lBRUQsZ0RBQWdEO0lBRWhELFFBQVE7UUFDTixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN2QixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1gsR0FBRyxJQUFJLENBQUMsS0FBSztZQUNiLGNBQWMsRUFBRSxFQUFFO1lBQ2xCLE1BQU0sRUFBRSxNQUFNO1lBQ2QsU0FBUyxFQUFFLElBQUk7WUFDZixRQUFRLEVBQUUsSUFBSTtZQUNkLFVBQVUsRUFBRSxHQUFHO1lBQ2YsU0FBUyxFQUFFLEdBQUc7WUFDZCxtQkFBbUIsRUFBRSxJQUFJO1lBQ3pCLGlCQUFpQixFQUFFLEVBQUU7WUFDckIsWUFBWSxFQUFFLFNBQVM7WUFDdkIsT0FBTyxFQUFFLEVBQUU7U0FDWixDQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7SUFDN0IsQ0FBQzs7b0hBMVFVLHVCQUF1Qjt3R0FBdkIsdUJBQXVCLDJUQzFCcEMsMmhHQTJGQTsyRkRqRWEsdUJBQXVCO2tCQVBuQyxTQUFTOytCQUNFLGtCQUFrQixpQkFHYixpQkFBaUIsQ0FBQyxJQUFJLG1CQUNwQix1QkFBdUIsQ0FBQyxNQUFNO3dHQWlDdEMsS0FBSztzQkFBYixLQUFLO2dCQUVPLFNBQVM7c0JBQXJCLEtBQUs7Z0JBcUNPLE9BQU87c0JBQW5CLEtBQUs7Z0JBSXVDLFdBQVc7c0JBQXZELFNBQVM7dUJBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTtnQkFDakMsYUFBYTtzQkFBdEIsTUFBTTtnQkFDRyxjQUFjO3NCQUF2QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG4gIFZpZXdDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvbnZlcnRJbWFnZVVzaW5nQ2FudmFzIH0gZnJvbSAnLi9mdW5jdGlvbnMvaW1hZ2UtcHJvY2Vzc2luZyc7XG5pbXBvcnQgeyBJbWFnZVBpY2tlckNvbmYsIElTdGF0ZSB9IGZyb20gJy4vbW9kZWxzL2luZGV4Lm1vZGVscyc7XG5pbXBvcnQgbGFiZWxFcyBmcm9tICcuL2kxOG4vZXMuanNvbic7XG5pbXBvcnQgbGFiZWxFbiBmcm9tICcuL2kxOG4vZW4uanNvbic7XG5pbXBvcnQgbGFiZWxGciBmcm9tICcuL2kxOG4vZnIuanNvbic7XG5pbXBvcnQgbGFiZWxEZSBmcm9tICcuL2kxOG4vZGUuanNvbic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25ncC1pbWFnZS1waWNrZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vbmdwLWltYWdlLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL25ncC1pbWFnZS1waWNrZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIE5ncEltYWdlUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgY29uZmlnOiBJbWFnZVBpY2tlckNvbmYgPSB7XG4gICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgb2JqZWN0Rml0OiAnY292ZXInLFxuICAgIGhpZGVEZWxldGVCdG46IGZhbHNlLFxuICAgIGhpZGVEb3dubG9hZEJ0bjogZmFsc2UsXG4gICAgaGlkZUVkaXRCdG46IGZhbHNlLFxuICAgIGhpZGVBZGRCdG46IGZhbHNlLFxuICB9O1xuXG4gIHN0YXRlOiBJU3RhdGUgPSB7XG4gICAgcXVhbGl0eTogOTIsXG4gICAgbWF4SGVpZ2h0OiAxMDAwLFxuICAgIG1heFdpZHRoOiAxMDAwLFxuICAgIGNyb3BIZWlnaHQ6IDE1MCxcbiAgICBjcm9wV2lkdGg6IDE1MCxcbiAgICBtYWludGFpbkFzcGVjdFJhdGlvOiB0cnVlLFxuICAgIGZvcm1hdDogJ2pwZWcnLFxuICAgIGFycmF5Q29waWVkSW1hZ2VzOiBbXSxcbiAgICBvcmlnaW5JbWFnZVNyYzogJycsXG4gIH07XG4gIGltYWdlU3JjOiBhbnk7XG4gIGxvYWRJbWFnZSA9IGZhbHNlO1xuICBmaWxlVHlwZTogc3RyaW5nID0gJyc7XG4gIHVybEltYWdlOiBzdHJpbmcgPSAnJztcbiAgdXVpZEZpbGVQaWNrZXIgPSBEYXRlLm5vdygpLnRvU3RyaW5nKDIwKTtcbiAgc2hvd0VkaXRQYW5lbCA9IGZhbHNlO1xuICBpbWFnZU5hbWUgPSAnZG9ubG9hZCc7XG4gIGxhYmVsczogYW55ID0gbGFiZWxFbjtcbiAgYXJyYXlDb3BpZWRJbWFnZXM6IGFueVtdID0gW107XG5cbiAgQElucHV0KCkgY29sb3I6IHN0cmluZyA9ICcjMWU4OGU1JztcblxuICBASW5wdXQoKSBzZXQgX2ltYWdlU3JjKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMucGFyc2VUb0Jhc2U2NCh2YWx1ZSkudGhlbigoZGF0YVVyaSkgPT4ge1xuICAgICAgICB0aGlzLmltYWdlU3JjID0gZGF0YVVyaTtcbiAgICAgICAgdGhpcy5zdGF0ZS5vcmlnaW5JbWFnZVNyYyA9IHZhbHVlO1xuICAgICAgICB0aGlzLnN0YXRlLmFycmF5Q29waWVkSW1hZ2VzLnB1c2goe1xuICAgICAgICAgIGxhc3RJbWFnZTogZGF0YVVyaSxcbiAgICAgICAgICB3aWR0aDogdGhpcy5zdGF0ZS5tYXhXaWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHRoaXMuc3RhdGUubWF4SGVpZ2h0LFxuICAgICAgICAgIHF1YWxpdHk6IHRoaXMuc3RhdGUucXVhbGl0eSxcbiAgICAgICAgICBmb3JtYXQ6IHRoaXMuc3RhdGUuZm9ybWF0LFxuICAgICAgICAgIG9yaWdpbkltYWdlU3JjOiB2YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJGltYWdlT3JpZ2luYWwubmV4dCh0aGlzLnN0YXRlLm9yaWdpbkltYWdlU3JjKTtcbiAgICAgICAgdGhpcy5sb2FkSW1hZ2UgPSB0cnVlO1xuICAgICAgICB0aGlzLmNoUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW1hZ2VTcmMgPSBudWxsO1xuICAgICAgdGhpcy5zdGF0ZS5vcmlnaW5JbWFnZVNyYyA9IG51bGw7XG4gICAgICB0aGlzLmxvYWRJbWFnZSA9IGZhbHNlO1xuICAgICAgdGhpcy5zdGF0ZS5hcnJheUNvcGllZEltYWdlcyA9IFtdO1xuICAgICAgdGhpcy4kaW1hZ2VPcmlnaW5hbC5uZXh0KG51bGwpO1xuICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgLi4udGhpcy5zdGF0ZSxcbiAgICAgICAgZm9ybWF0OiAnanBlZycsXG4gICAgICAgIG1heEhlaWdodDogMTAwMCxcbiAgICAgICAgbWF4V2lkdGg6IDEwMDAsXG4gICAgICAgIGNyb3BIZWlnaHQ6IDE1MCxcbiAgICAgICAgY3JvcFdpZHRoOiAxNTAsXG4gICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IHRydWUsXG4gICAgICB9O1xuICAgICAgdGhpcy5zaG93RWRpdFBhbmVsID0gZmFsc2U7XG4gICAgICB0aGlzLmNoUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBfY29uZmlnKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLnByb2Nlc3NDb25maWcodmFsdWUpO1xuICB9XG5cbiAgQFZpZXdDaGlsZCgnaW1hZ2VQaWNrZXInLCB7IHN0YXRpYzogZmFsc2UgfSkgaW1hZ2VQaWNrZXI6IEVsZW1lbnRSZWYgfCBudWxsIHwgdW5kZWZpbmVkID0gbnVsbDtcbiAgQE91dHB1dCgpICRpbWFnZUNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSAkaW1hZ2VPcmlnaW5hbDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNoUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmFwcGVuZExpbmtJY29uc1RvSGVhZCgpO1xuICB9XG5cbiAgYXBwZW5kTGlua0ljb25zVG9IZWFkKCkge1xuICAgIGxldCBoZWFkOiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmhlYWQ7XG4gICAgbGV0IGxpbmtJY29uczogSFRNTEVsZW1lbnQgfCBudWxsIHwgdW5kZWZpbmVkID0gaGVhZC5xdWVyeVNlbGVjdG9yKCcjbmdwLWltYWdlLXBpY2tlci1pY29ucy1pZCcpIGFzIEhUTUxFbGVtZW50O1xuICAgIGlmIChsaW5rSWNvbnMpIHJldHVybjtcbiAgICBsZXQgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgICBsaW5rLmhyZWYgPSAnaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9pY29uP2ZhbWlseT1NYXRlcmlhbCtJY29ucyc7XG4gICAgbGluay5yZWwgPSAnc3R5bGVzaGVldCc7XG4gICAgbGluay5pZCA9ICduZ3AtaW1hZ2UtcGlja2VyLWljb25zLWlkJztcbiAgICBoZWFkLmFwcGVuZENoaWxkKGxpbmspO1xuICB9XG5cbiAgb25VcGxvYWQoZXZlbnQ6IGFueSkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5pbWFnZVBpY2tlcj8ubmF0aXZlRWxlbWVudC5jbGljaygpO1xuICB9XG5cbiAgaGFuZGxlRmlsZVNlbGVjdChldnQ6IGFueSkge1xuICAgIGNvbnN0IGZpbGVzID0gZXZ0LnRhcmdldD8uZmlsZXM7XG4gICAgaWYgKGZpbGVzKSB7XG4gICAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07XG5cbiAgICAgIHRoaXMuaW1hZ2VOYW1lID0gZmlsZS5uYW1lLnNwbGl0KCcuJylbMF07XG4gICAgICB0aGlzLmZpbGVUeXBlID0gZmlsZS50eXBlO1xuICAgICAgaWYgKCF0aGlzLmZpbGVUeXBlLmluY2x1ZGVzKCdpbWFnZScpKSByZXR1cm47XG4gICAgICB0aGlzLnVybEltYWdlID0gYGRhdGE6JHtmaWxlLnR5cGV9O2Jhc2U2NCxgO1xuICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5mb3JtYXQgPSB0aGlzLmZpbGVUeXBlLnNwbGl0KCdpbWFnZS8nKVsxXTtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IHRoaXMuaGFuZGxlUmVhZGVyTG9hZGVkLmJpbmQodGhpcyk7XG4gICAgICAgIHJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlUmVhZGVyTG9hZGVkKHJlYWRlckV2dDogYW55KSB7XG4gICAgY29uc3QgYmluYXJ5U3RyaW5nID0gcmVhZGVyRXZ0LnRhcmdldC5yZXN1bHQ7XG4gICAgY29uc3QgYmFzZTY0dGV4dFN0cmluZyA9IGJ0b2EoYmluYXJ5U3RyaW5nKTtcbiAgICB0aGlzLnN0YXRlLm9yaWdpbkltYWdlU3JjID0gdGhpcy51cmxJbWFnZSArIGJhc2U2NHRleHRTdHJpbmc7XG4gICAgaWYgKHRoaXMuY29uZmlnLmNvbXByZXNzSW5pdGlhbCkge1xuICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgLi4udGhpcy5zdGF0ZSxcbiAgICAgICAgcXVhbGl0eTogTWF0aC5taW4odGhpcy5jb25maWcuY29tcHJlc3NJbml0aWFsIHx8IDkyLCAxMDApLFxuICAgICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiB0cnVlLFxuICAgICAgICBmb3JtYXQ6ICdqcGVnJyxcbiAgICAgIH07XG4gICAgICB0aGlzLmltYWdlU3JjID0gYXdhaXQgY29udmVydEltYWdlVXNpbmdDYW52YXModGhpcy51cmxJbWFnZSArIGJhc2U2NHRleHRTdHJpbmcsIGZhbHNlLCB0aGlzLnN0YXRlLCB7IGdldERpbUZyb21JbWFnZTogdHJ1ZSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbWFnZVNyYyA9IHRoaXMudXJsSW1hZ2UgKyBiYXNlNjR0ZXh0U3RyaW5nO1xuICAgICAgbGV0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgaW1nLnNyYyA9IHRoaXMuaW1hZ2VTcmM7XG4gICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlLmFycmF5Q29waWVkSW1hZ2VzID0gW107XG4gICAgICAgIHRoaXMuc3RhdGUubWF4SGVpZ2h0ID0gaW1nLmhlaWdodDtcbiAgICAgICAgdGhpcy5zdGF0ZS5tYXhXaWR0aCA9IGltZy53aWR0aDtcbiAgICAgICAgdGhpcy5zdGF0ZS5hcnJheUNvcGllZEltYWdlcy5wdXNoKHtcbiAgICAgICAgICBsYXN0SW1hZ2U6IHRoaXMuaW1hZ2VTcmMsXG4gICAgICAgICAgd2lkdGg6IGltZy53aWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IGltZy5oZWlnaHQsXG4gICAgICAgICAgcXVhbGl0eTogdGhpcy5zdGF0ZS5xdWFsaXR5LFxuICAgICAgICAgIGZvcm1hdDogdGhpcy5zdGF0ZS5mb3JtYXQsXG4gICAgICAgICAgb3JpZ2luSW1hZ2VTcmM6IHRoaXMuc3RhdGUub3JpZ2luSW1hZ2VTcmMgYXMgc3RyaW5nLFxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfVxuICAgIHRoaXMuJGltYWdlQ2hhbmdlZC5uZXh0KHRoaXMuaW1hZ2VTcmMpO1xuICAgIHRoaXMubG9hZEltYWdlID0gdHJ1ZTtcbiAgICB0aGlzLmNoUmVmLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgb25PcGVuRWRpdFBhbmVsKCkge1xuICAgIHRoaXMuc2hvd0VkaXRQYW5lbCA9IHRydWU7XG4gIH1cblxuICBvbkNsb3NlRWRpdFBhbmVsKGRhdGE6IGFueSkge1xuICAgIGlmIChkYXRhKSB7XG4gICAgICB0aGlzLnN0YXRlID0gZGF0YS5zdGF0ZTtcbiAgICAgIHRoaXMuaW1hZ2VTcmMgPSBkYXRhLmltYWdlU3JjO1xuICAgICAgdGhpcy4kaW1hZ2VDaGFuZ2VkLm5leHQodGhpcy5pbWFnZVNyYyk7XG4gICAgfVxuICAgIHRoaXMuc2hvd0VkaXRQYW5lbCA9IGZhbHNlO1xuICB9XG5cbiAgcGFyc2VUb0Jhc2U2NChpbWFnZVVybDogc3RyaW5nKSB7XG4gICAgbGV0IHR5cGVzID0gaW1hZ2VVcmwuc3BsaXQoJy4nKTtcbiAgICBsZXQgdHlwZSA9IHR5cGVzW3R5cGVzLmxlbmd0aCAtIDFdO1xuICAgIGlmICh0eXBlICYmICh0eXBlID09ICdwbmcnIHx8IHR5cGUgPT0gJ2pwZWcnIHx8IHR5cGUgPT0gJ3dlYnAnKSkge1xuICAgICAgdHlwZSA9IHR5cGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHR5cGUgPSAnanBlZyc7XG4gICAgfVxuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIC4uLnRoaXMuc3RhdGUsXG4gICAgICBmb3JtYXQ6IHR5cGUsXG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAnQW5vbnltb3VzJztcbiAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgIC4uLnRoaXMuc3RhdGUsXG4gICAgICAgIG1heEhlaWdodDogaW1nLmhlaWdodCxcbiAgICAgICAgbWF4V2lkdGg6IGltZy53aWR0aCxcbiAgICAgIH07XG4gICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xuICAgICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgIGxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgaWYgKCFjdHgpIHJldHVybjtcbiAgICAgICAgbGV0IHJhdGlvID0gMS4wO1xuICAgICAgICBjYW52YXMud2lkdGggPSBpbWcud2lkdGggKiByYXRpbztcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQgKiByYXRpbztcbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgIGxldCBkYXRhVVJJID0gY2FudmFzLnRvRGF0YVVSTChgaW1hZ2UvJHt0eXBlfWAsIHRoaXMuc3RhdGUucXVhbGl0eSk7XG4gICAgICAgIHJldHVybiByZXNvbHZlKHtcbiAgICAgICAgICBkYXRhVXJpOiBkYXRhVVJJLFxuICAgICAgICAgIHdpZHRoOiBjYW52YXMud2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiBjYW52YXMuaGVpZ2h0LFxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICBpbWcub25lcnJvciA9IChlOiBhbnkpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChlLm1lc3NhZ2UgfHwgYEVycm9yIGxvYWRpbmcgdGhlIHNyYyA9ICR7aW1hZ2VVcmx9YCk7XG4gICAgICB9O1xuICAgICAgaW1nLnNyYyA9IGltYWdlVXJsO1xuICAgIH0pLnRoZW4oKGRhdGE6IGFueSkgPT4ge1xuICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgLi4udGhpcy5zdGF0ZSxcbiAgICAgICAgbWF4SGVpZ2h0OiBkYXRhLmhlaWdodCxcbiAgICAgICAgbWF4V2lkdGg6IGRhdGEud2lkdGgsXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGRhdGEuZGF0YVVyaTtcbiAgICB9KTtcbiAgfVxuXG4gIHByb2Nlc3NDb25maWcodmFsdWU6IEltYWdlUGlja2VyQ29uZikge1xuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PSBPYmplY3QpIHtcbiAgICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4udmFsdWUgfTtcbiAgICAgIGlmICh2YWx1ZS5sYW5ndWFnZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKHZhbHVlLmxhbmd1YWdlID09ICdlbicpIHtcbiAgICAgICAgICB0aGlzLmxhYmVscyA9IHsgLi4ubGFiZWxFbiB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZS5sYW5ndWFnZSA9PSAnZXMnKSB7XG4gICAgICAgICAgdGhpcy5sYWJlbHMgPSB7IC4uLmxhYmVsRXMgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsdWUubGFuZ3VhZ2UgPT0gJ2ZyJykge1xuICAgICAgICAgIHRoaXMubGFiZWxzID0geyAuLi5sYWJlbEZyIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlLmxhbmd1YWdlID09ICdkZScpIHtcbiAgICAgICAgICB0aGlzLmxhYmVscyA9IHsgLi4ubGFiZWxEZSB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY2FsY3VsYXRlU2l6ZSgpIHtcbiAgICBpZiAodGhpcy5pbWFnZVNyYyAmJiB0aGlzLmltYWdlU3JjLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIE1hdGguY2VpbCgoKDMgLyA0KSAqIHRoaXMuaW1hZ2VTcmMubGVuZ3RoKSAvIDEwMjQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBvblJlbW92ZSgpIHtcbiAgICB0aGlzLmltYWdlU3JjID0gbnVsbDtcbiAgICB0aGlzLmxvYWRJbWFnZSA9IGZhbHNlO1xuICAgIHRoaXMuJGltYWdlT3JpZ2luYWwubmV4dChudWxsKTtcbiAgICB0aGlzLiRpbWFnZUNoYW5nZWQubmV4dChudWxsKTtcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgLi4udGhpcy5zdGF0ZSxcbiAgICAgIG9yaWdpbkltYWdlU3JjOiAnJyxcbiAgICAgIGZvcm1hdDogJ2pwZWcnLFxuICAgICAgbWF4SGVpZ2h0OiAxMDAwLFxuICAgICAgbWF4V2lkdGg6IDEwMDAsXG4gICAgICBjcm9wSGVpZ2h0OiAxNTAsXG4gICAgICBjcm9wV2lkdGg6IDE1MCxcbiAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IHRydWUsXG4gICAgICBhcnJheUNvcGllZEltYWdlczogW10sXG4gICAgICBiYXNpY0ZpbHRlcnM6IHVuZGVmaW5lZCxcbiAgICAgIHF1YWxpdHk6IDkyLFxuICAgIH07XG4gICAgdGhpcy5zaG93RWRpdFBhbmVsID0gZmFsc2U7XG4gIH1cbn1cbiIsIjxkaXYgKm5nSWY9XCIhbG9hZEltYWdlXCIgY2xhc3M9XCJwbGFjZS1pbWFnZVwiPlxuICA8ZGl2XG4gICAgY2xhc3M9XCJpbWFnZS1ob2xkZXJcIlxuICAgIFtuZ1N0eWxlXT1cIntcbiAgICAgIHdpZHRoOiB0aGlzLmNvbmZpZy53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5jb25maWcuaGVpZ2h0LFxuICAgICAgYm9yZGVyUmFkaXVzOiB0aGlzLmNvbmZpZy5ib3JkZXJSYWRpdXMsXG4gICAgICBhc3BlY3RSYXRpbzogdGhpcy5jb25maWcuYXNwZWN0UmF0aW9cbiAgICB9XCJcbiAgPlxuICAgIDxidXR0b24gdGl0bGU9XCJ7eyBsYWJlbHNbJ1VwbG9hZCBhIGltYWdlJ10gfX1cIiBjbGFzcz1cImljb24tYnRuIGltYWdlLXVwbG9hZC1idG5cIiAoY2xpY2spPVwib25VcGxvYWQoJGV2ZW50KVwiPlxuICAgICAgPCEtLSAgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmFkZF9hX3Bob3RvPC9tYXQtaWNvbj4gLS0+XG4gICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+YWRkX2FfcGhvdG88L3NwYW4+XG4gICAgPC9idXR0b24+XG5cbiAgICA8aW5wdXQgI2ltYWdlUGlja2VyIHR5cGU9XCJmaWxlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCIgW2lkXT1cIidmaWxlUGlja2VyLScgKyB0aGlzLnV1aWRGaWxlUGlja2VyXCIgKGNoYW5nZSk9XCJoYW5kbGVGaWxlU2VsZWN0KCRldmVudClcIiAvPlxuICA8L2Rpdj5cbjwvZGl2PlxuPGRpdiAqbmdJZj1cImxvYWRJbWFnZVwiIGNsYXNzPVwicGxhY2UtaW1hZ2VcIj5cbiAgPGRpdlxuICAgIGNsYXNzPVwiaW1hZ2UtaG9sZGVyLWxvYWRlZFwiXG4gICAgW25nU3R5bGVdPVwie1xuICAgICAgd2lkdGg6IHRoaXMuY29uZmlnLndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLmNvbmZpZy5oZWlnaHQsXG4gICAgICBib3JkZXJSYWRpdXM6IHRoaXMuY29uZmlnLmJvcmRlclJhZGl1cyxcbiAgICAgIGFzcGVjdFJhdGlvOiB0aGlzLmNvbmZpZy5hc3BlY3RSYXRpb1xuICAgIH1cIlxuICA+XG4gICAgPGltZ1xuICAgICAgW3NyY109XCJ0aGlzLmltYWdlU3JjXCJcbiAgICAgIGFsdD1cImltYWdlLWxvYWRlZFwiXG4gICAgICBbbmdTdHlsZV09XCJ7IGJvcmRlclJhZGl1czogdGhpcy5jb25maWcuYm9yZGVyUmFkaXVzLCBvYmplY3RGaXQ6IHRoaXMuY29uZmlnLm9iamVjdEZpdCB9XCJcbiAgICAvPlxuICAgIDxpbnB1dCAjaW1hZ2VQaWNrZXIgdHlwZT1cImZpbGVcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIiBbaWRdPVwiJ2ZpbGVQaWNrZXItJyArIHRoaXMudXVpZEZpbGVQaWNrZXJcIiAoY2hhbmdlKT1cImhhbmRsZUZpbGVTZWxlY3QoJGV2ZW50KVwiIC8+XG4gIDwvZGl2PlxuICA8cFxuICAgICpuZ0lmPVwidGhpcy5jYWxjdWxhdGVTaXplKClcIlxuICAgIGNsYXNzPVwiY2FwdGlvbiBpbWFnZS1jYXB0aW9uXCJcbiAgICBbbmdTdHlsZV09XCJ7XG4gICAgICBjb2xvcjogdGhpcy5jYWxjdWxhdGVTaXplKCkgPiAxMjAgPyAnI2Y0NDMzNicgOiAndW5zZXQnLFxuICAgICAgZm9udFdlaWdodDogdGhpcy5jYWxjdWxhdGVTaXplKCkgPiAxMjAgPyAnNTAwJyA6ICd1bnNldCdcbiAgICB9XCJcbiAgPlxuICAgIHNpemU6IHt7IHRoaXMuY2FsY3VsYXRlU2l6ZSgpIH19S2IgJm5ic3A7IHt7IHRoaXMuc3RhdGUuZm9ybWF0IH19XG4gIDwvcD5cblxuICA8ZGl2XG4gICAgc3R5bGU9XCJmbGV4LWRpcmVjdGlvbjogcm93OyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBkaXNwbGF5OiBmbGV4OyBwbGFjZS1jb250ZW50OiBmbGV4LXN0YXJ0OyBhbGlnbi1pdGVtczogZmxleC1zdGFydFwiXG4gICAgY2xhc3M9XCJlZGl0aW5nLWJhci1idG5cIlxuICA+XG4gICAgPGJ1dHRvblxuICAgICAgY2xhc3M9XCJpY29uLWJ0blwiXG4gICAgICBpZD1cInVwbG9hZC1pbWdcIlxuICAgICAgKm5nSWY9XCIhdGhpcy5jb25maWcuaGlkZUFkZEJ0blwiXG4gICAgICB0aXRsZT1cInt7IGxhYmVsc1snVXBsb2FkIGEgaW1hZ2UnXSB9fVwiXG4gICAgICAoY2xpY2spPVwib25VcGxvYWQoJGV2ZW50KVwiXG4gICAgPlxuICAgICAgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmFkZF9hX3Bob3RvPC9zcGFuPlxuICAgIDwvYnV0dG9uPlxuICAgIDxidXR0b25cbiAgICAgIGNsYXNzPVwiaWNvbi1idG5cIlxuICAgICAgaWQ9XCJlZGl0LWltZ1wiXG4gICAgICAqbmdJZj1cIiF0aGlzLmNvbmZpZy5oaWRlRWRpdEJ0blwiXG4gICAgICB0aXRsZT1cInt7IGxhYmVsc1snT3BlbiB0aGUgZWRpdG9yIHBhbmVsJ10gfX1cIlxuICAgICAgKGNsaWNrKT1cIm9uT3BlbkVkaXRQYW5lbCgpXCJcbiAgICA+XG4gICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+ZWRpdDwvc3Bhbj5cbiAgICA8L2J1dHRvbj5cbiAgICA8YVxuICAgICAgaWQ9XCJkb3dubG9hZC1pbWdcIlxuICAgICAgKm5nSWY9XCIhdGhpcy5jb25maWcuaGlkZURvd25sb2FkQnRuXCJcbiAgICAgIHRpdGxlPVwie3sgbGFiZWxzWydEb3dubG9hZCB0aGUgaW1hZ2UnXSB9fVwiXG4gICAgICBbaHJlZl09XCJ0aGlzLmltYWdlU3JjXCJcbiAgICAgIGRvd25sb2FkPVwie3sgaW1hZ2VOYW1lIH19XCJcbiAgICA+XG4gICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+Y2xvdWRfZG93bmxvYWQ8L3NwYW4+XG4gICAgPC9hPlxuICAgIDxidXR0b24gY2xhc3M9XCJpY29uLWJ0blwiIGlkPVwiZGVsZXRlLWltZ1wiICpuZ0lmPVwiIXRoaXMuY29uZmlnLmhpZGVEZWxldGVCdG5cIiB0aXRsZT1cInt7IGxhYmVsc1snUmVtb3ZlJ10gfX1cIiAoY2xpY2spPVwib25SZW1vdmUoKVwiPlxuICAgICAgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmRlbGV0ZTwvc3Bhbj5cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG48L2Rpdj5cblxuPGxpYi1lZGl0LWltYWdlXG4gICpuZ0lmPVwic2hvd0VkaXRQYW5lbFwiXG4gIFtpbWFnZVNyY109XCJ0aGlzLmltYWdlU3JjXCJcbiAgW2luaXRpYWxTdGF0ZV09XCJ0aGlzLnN0YXRlXCJcbiAgW2xhYmVsc109XCJ0aGlzLmxhYmVsc1wiXG4gIFtjb2xvcl09XCJ0aGlzLmNvbG9yXCJcbiAgKGNsb3NlTW9kYWwpPVwidGhpcy5vbkNsb3NlRWRpdFBhbmVsKCRldmVudClcIlxuPjwvbGliLWVkaXQtaW1hZ2U+XG4iXX0=